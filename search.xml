<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ARTS-01</title>
    <url>/2019/06/30/ARTS-01/</url>
    <content><![CDATA[<h3 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h3><p>Two Sum ä¸¤æ•°ä¹‹å’Œï¼ˆleetcode #1ï¼‰</p>
<p>â€œå¹³ç”Ÿä¸è¯† TwoSumï¼Œåˆ·å°½ LeetCode ä¹Ÿæ‰ç„¶ã€‚â€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Given an array of integers, return indices of the two numbers such that they add up to a specific target.</span><br><span class="line"></span><br><span class="line">You may assume that each input would have exactly one solution, and you may not use the same element twice.</span><br><span class="line"></span><br><span class="line">Example:</span><br><span class="line"></span><br><span class="line">Given nums &#x3D; [2, 7, 11, 15], target &#x3D; 9,</span><br><span class="line"></span><br><span class="line">Because nums[0] + nums[1] &#x3D; 2 + 7 &#x3D; 9,</span><br><span class="line">return [0, 1].</span><br></pre></td></tr></table></figure>

<p><strong>è§£é¢˜æ€è·¯</strong>ï¼š<br>æœ¬é¢˜çš„è¦æ±‚æ˜¯æ‰¾åˆ°ä¸¤æ•°ä¹‹å’Œç­‰äº target çš„ä»¥è¿™ä¸¤ä¸ªæ•°çš„ä¸‹è¡¨ä¸ºå…ƒç´ çš„æ•°ç»„ï¼Œåˆæ­¥çš„æƒ³æ³•åº”è¯¥ç”¨HashMap å­˜ä¸‹éå† numsæ•°ç»„çš„ä¸‹è¡¨ä¸å¯¹åº”çš„å€¼ï¼Œå¹¶ä¸”åˆ¤æ–­å½“ ç”¨targetå‡å» å·²å­˜åœ¨çš„æ•°å¾—åˆ°æ•°ç»„ä¸­å¦ä¸€ä¸ªæ•°æ—¶ï¼Œæ»¡è¶³é¢˜ç›®çš„è¦æ±‚ï¼Œè¿”å›ä»–ä»¬çš„ä¸‹æ ‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public int[] twoSum(int[] nums, int target) &#123;</span><br><span class="line">        HashMap&lt;Integer, Integer&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        int[] result &#x3D; new int[2];</span><br><span class="line">        for (int i &#x3D; 0; i &lt; nums.length; i++) &#123;</span><br><span class="line">            if (map.containsKey(target - nums[i])) &#123;</span><br><span class="line">                result[0] &#x3D; map.get(target - nums[i]);</span><br><span class="line">                result[1] &#x3D; i;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">            map.put(nums[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Reading"><a href="#Reading" class="headerlink" title="Reading"></a>Reading</h3><p><strong>Top Signs of an Over-Experienced Programmer</strong><br><a href="https://medium.com/better-programming/top-signs-of-an-over-experienced-programmer-22bbe0b57663" target="_blank" rel="noopener">https://medium.com/better-programming/top-signs-of-an-over-experienced-programmer-22bbe0b57663</a></p>
<p>åªè¦æˆ‘ä»¬è¿˜æ˜¯programmer æˆ‘ä»¬çš„é‡å¿ƒè¿˜æ˜¯è¦æ”¾åˆ°programming ä¸ engineering ä¸Šï¼Œè¿‡åº¦åœ°è€ƒè™‘éœ€æ±‚æ˜¯å¦åˆç†ï¼Œé¡¹ç›®æ˜¯å¦èƒ½æ»¡è¶³ç”¨æˆ·éœ€æ±‚ç­‰å¹¶ä¸æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„é‡å¿ƒã€‚æˆ‘ä»¬éœ€è¦é¿å…ä¸å¿…è¦çš„refactoringï¼Œä»¥å°½å¯èƒ½perfectåœ°å®ç°éœ€æ±‚ä¸ºç›®æ ‡ï¼Œæ·±å…¥åˆ°code engineeringæ‰æ˜¯ã€‚</p>
<h3 id="Tip"><a href="#Tip" class="headerlink" title="Tip"></a>Tip</h3><p><strong>æœ¬å‘¨åœ¨åšæ–°é¡¹ç›®æ—¶åˆé‡æ–°ç”¨åˆ°äº† hibernate mybatis å’Œ jdbcTemplateã€‚ä¸‹é¢é’ˆå¯¹è¿™äº›å·¥å…·æˆ‘ä¸ªäººçš„ä¸€äº›çœ‹æ³•</strong></p>
<ul>
<li>hibernate è™½ç„¶æ¯”è¾ƒæ–¹ä¾¿ï¼Œç»“åˆSpring Data JPA å¯ä»¥éå¸¸æ–¹ä¾¿çš„å†™å‡ºcrudé€»è¾‘ï¼Œä½†ç¼ºç‚¹ä¹Ÿéå¸¸æ˜æ˜¾ï¼Œå°±æ˜¯ç›¸å¯¹å…¶ä»–ä¸¤ä¸ªæ¥è¯´å¤ªä¸çµæ´»äº†ï¼Œå¦‚æœä¸å°å¿ƒå¼€å¯äº†è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“çš„é…ç½®ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„å¤–é”®å¤Ÿè®©ä½ éš¾å—çš„äº†ã€‚</li>
<li>mybatis ä½¿ç”¨èµ·æ¥ä¸­è§„ä¸­çŸ©ï¼Œä½†è¿˜æ˜¯ä¸å¤Ÿçµæ´»ï¼Œä»¿ä½›æ‰è¿›äº†ç»´æŠ¤æ•°æ®è¡¨é—´å…³ç³»çš„å‘é‡Œã€‚</li>
<li>jdbcTemplate æˆ‘ç”¨å¾—æœ€é¡ºæ‰‹ï¼Œç‰¹åˆ«æ˜¯ NamedParameterJdbcTemplateï¼Œé€šè¿‡æ‰‹åŠ¨æ‹¼æ¥SQLå®ç°å¤æ‚çš„é€»è¾‘éå¸¸å¥½ç”¨ï¼Œè¿˜ä¸å¿…åƒåœ¨PreparedStatementä¸­ä¸€æ ·æ•°é—®å·ğŸ¤£</li>
</ul>
<h3 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h3><p><strong>æœ¬å‘¨åˆ†äº«çš„æ–‡ç« æ˜¯æ¥è‡ª é˜¿é‡Œäº‘äº‘æ –ç¤¾åŒº çš„ä¸€ç¯‡å…³äºHashMapçš„æ–‡ç« </strong><br>ç”±é˜¿é‡Œå·´å·´Javaå¼€å‘è§„çº¦HashMapæ¡ç›®å¼•å‘çš„æ•…äº‹<br><a href="https://zhuanlan.zhihu.com/p/30360734" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/30360734</a></p>
]]></content>
      <categories>
        <category>ARTS</category>
      </categories>
      <tags>
        <tag>ARTS</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS-02.md</title>
    <url>/2019/07/14/ARTS-02/</url>
    <content><![CDATA[<h3 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h3><p>Print in Orderï¼ˆ1114ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Suppose we have a class:</span><br><span class="line"></span><br><span class="line">public class Foo &#123;</span><br><span class="line">Â  public void one() &#123; print(&quot;one&quot;); &#125;</span><br><span class="line">Â  public void two() &#123; print(&quot;two&quot;); &#125;</span><br><span class="line">Â  public void three() &#123; print(&quot;three&quot;); &#125;</span><br><span class="line">&#125;</span><br><span class="line">The same instance of Foo will be passed to three different threads. Thread A will call one(), thread B will call two(), and thread C will call three(). Design a mechanism and modify the programÂ to ensure thatÂ two()Â is executed afterÂ one(), andÂ three() is executed afterÂ two().</span><br><span class="line"></span><br><span class="line">æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰</span><br><span class="line">é“¾æ¥ï¼šhttps:&#x2F;&#x2F;leetcode-cn.com&#x2F;problems&#x2F;print-in-order</span><br><span class="line">è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</span><br></pre></td></tr></table></figure>
<p><strong>è§£é¢˜æ€è·¯</strong>ï¼š<br>leetcodeå…³äºå¤šçº¿ç¨‹çš„æ–°é¢˜ï¼Œè€ƒå¯Ÿå¤šçº¿ç¨‹ä¸­çš„æŒ‰åºæ‰§è¡Œã€‚<br>å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•è§£ï¼š</p>
<ol>
<li>åˆ©ç”¨CountDownLatch æ¥æ§åˆ¶æ‰§è¡Œçš„é¡ºåºã€‚</li>
<li>åˆ©ç”¨volatile åˆ›å»ºå…¨å±€å¯è§çš„å˜é‡ï¼Œé€šè¿‡å¯¹è¯¥å˜é‡çš„åŸå­æ€§æ›´æ–°æ¥ä¿è¯æ‰§è¡Œé¡ºåºã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line">class Foo &#123;</span><br><span class="line">    private CountDownLatch c2;</span><br><span class="line">    private CountDownLatch c3;</span><br><span class="line"></span><br><span class="line">    public Foo() &#123;</span><br><span class="line">        c2 &#x3D; new CountDownLatch(1);</span><br><span class="line">        c3 &#x3D; new CountDownLatch(1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void first(Runnable printFirst) throws InterruptedException &#123;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; printFirst.run() outputs &quot;first&quot;. Do not change or remove this line.</span><br><span class="line">        printFirst.run();</span><br><span class="line">        c2.countDown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void second(Runnable printSecond) throws InterruptedException &#123;</span><br><span class="line">        c2.await();</span><br><span class="line">        &#x2F;&#x2F; printSecond.run() outputs &quot;second&quot;. Do not change or remove this line.</span><br><span class="line">        printSecond.run();</span><br><span class="line">        c3.countDown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void third(Runnable printThird) throws InterruptedException &#123;</span><br><span class="line">        c3.await();</span><br><span class="line">        &#x2F;&#x2F; printThird.run() outputs &quot;third&quot;. Do not change or remove this line.</span><br><span class="line">        printThird.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Foo &#123;</span><br><span class="line"></span><br><span class="line">    private volatile int flag &#x3D; 1;</span><br><span class="line">    public Foo() &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void first(Runnable printFirst) throws InterruptedException &#123;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; printFirst.run() outputs &quot;first&quot;. Do not change or remove this line.</span><br><span class="line">        printFirst.run();</span><br><span class="line">        flag &#x3D; 2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void second(Runnable printSecond) throws InterruptedException &#123;</span><br><span class="line">        while(flag !&#x3D; 2);</span><br><span class="line">        &#x2F;&#x2F; printSecond.run() outputs &quot;second&quot;. Do not change or remove this line.</span><br><span class="line">        printSecond.run();</span><br><span class="line">        flag &#x3D; 3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void third(Runnable printThird) throws InterruptedException &#123;</span><br><span class="line">        while(flag !&#x3D; 3);</span><br><span class="line">        &#x2F;&#x2F; printThird.run() outputs &quot;third&quot;. Do not change or remove this line.</span><br><span class="line">        printThird.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Reading"><a href="#Reading" class="headerlink" title="Reading"></a>Reading</h3><p><strong>Faircode, an alternative to Open Source that aims to get developers paid</strong><br><a href="https://hackernoon.com/faircode-an-alternative-to-open-source-89cdc65df3fa" target="_blank" rel="noopener">https://hackernoon.com/faircode-an-alternative-to-open-source-89cdc65df3fa</a></p>
<p>åœ¨2017å¹´ä½œè€…æå‡ºäº†Faircodeè¿™ä¸ªæ¦‚å¿µï¼Œæ—¨åœ¨ç»™å¼€å‘è€…ä¸€ä¸ªæ–°çš„ç›ˆåˆ©æ–¹å¼ã€‚ä¸åŒäºâ€œé—­æºè½¯ä»¶â€ï¼ŒFaircode æ‰“ç®—ä»¥å‘å¤§å…¬å¸æ”¶è´¹è€Œå¯¹å°å…¬å¸å…è´¹çš„å½¢åŠ¿è·åˆ©ã€‚ç„¶è€Œä¸å¹¸çš„æ˜¯ï¼Œä½œè€…å‘èµ·çš„Faircode åŠç›¸å…³çš„license å·²ç»è¢«åˆ é™¤äº†ã€‚ä½œè€…æƒ³æ³•åœ¨å½“æ—¶æ¯”è¾ƒå‰å«ï¼Œå¯èƒ½åœ¨æ¨è¡Œçš„è¿‡ç¨‹ä¸­æˆæ•ˆä¸å¤§å§ã€‚</p>
<h3 id="Tip"><a href="#Tip" class="headerlink" title="Tip"></a>Tip</h3><p><a href="https://javarevisited.blogspot.com/2018/05/10-tips-to-become-better-java-developer.html" target="_blank" rel="noopener">https://javarevisited.blogspot.com/2018/05/10-tips-to-become-better-java-developer.html</a></p>
<h3 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h3><p>JAVA æ³¨è§£çš„åŸºæœ¬åŸç†</p>
<p><a href="https://juejin.im/post/5b45bd715188251b3a1db54f" target="_blank" rel="noopener">https://juejin.im/post/5b45bd715188251b3a1db54f</a></p>
]]></content>
      <categories>
        <category>ARTS</category>
      </categories>
      <tags>
        <tag>ARTS</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS-03</title>
    <url>/2019/07/26/ARTS-03/</url>
    <content><![CDATA[<h3 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h3><p>Add Two Numbers(#2)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;*</span><br><span class="line"> * @lc app&#x3D;leetcode.cn id&#x3D;2 lang&#x3D;java</span><br><span class="line"> *</span><br><span class="line"> * [2] ä¸¤æ•°ç›¸åŠ </span><br><span class="line"> *&#x2F;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * Definition for singly-linked list.</span><br><span class="line"> * public class ListNode &#123;</span><br><span class="line"> *     int val;</span><br><span class="line"> *     ListNode next;</span><br><span class="line"> *     ListNode(int x) &#123; val &#x3D; x; &#125;</span><br><span class="line"> * &#125;</span><br><span class="line"> *&#x2F;</span><br><span class="line">class Solution &#123;</span><br><span class="line">    public ListNode addTwoNumbers(ListNode l1, ListNode l2) &#123;</span><br><span class="line">        ListNode pre &#x3D; new ListNode(0);</span><br><span class="line">        ListNode cur &#x3D; pre;</span><br><span class="line">        int carry &#x3D; 0;</span><br><span class="line">        while (l1 !&#x3D; null || l2 !&#x3D; null) &#123;</span><br><span class="line">            int x &#x3D; l1 &#x3D;&#x3D; null ? 0 : l1.val;</span><br><span class="line">            int y &#x3D; l2 &#x3D;&#x3D; null ? 0 : l2.val;</span><br><span class="line">            int sum &#x3D; x + y + carry;</span><br><span class="line">            </span><br><span class="line">            carry &#x3D; sum &#x2F; 10;</span><br><span class="line">            sum &#x3D; sum % 10;</span><br><span class="line">            cur.next &#x3D; new ListNode(sum);</span><br><span class="line"></span><br><span class="line">            cur &#x3D; cur.next;</span><br><span class="line">            if (l1 !&#x3D; null) &#123;</span><br><span class="line">                l1 &#x3D; l1.next;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (l2 !&#x3D; null) &#123;</span><br><span class="line">                l2 &#x3D; l2.next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (carry &#x3D;&#x3D; 1) &#123;</span><br><span class="line">            cur.next &#x3D; new ListNode(carry);</span><br><span class="line">        &#125;</span><br><span class="line">        return pre.next;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é“é¢˜æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè¾…åŠ©èŠ‚ç‚¹pre å†ç”¨ä¸€ä¸ªèŠ‚ç‚¹curæŒ‡å‘æˆ‘ä»¬æ­£åœ¨è¿›è¡Œè®¡ç®—çš„ç»“æœé“¾è¡¨ä¸Šçš„èŠ‚ç‚¹ã€‚</p>
<p>é€šè¿‡å¯¹l1, l2è¿™ä¸¤æ¡é“¾åšéå†ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—l1, l2 å½“å‰èŠ‚ç‚¹çš„å€¼x å’Œ yï¼Œå¯ä»¥è®¡ç®—å‡ºä»–ä»¬ä¸è¿›ä½æ ‡è¯†ï¼ˆå˜é‡carryï¼Œåˆå§‹å€¼ä¸º0ï¼‰çš„å’Œsumã€‚å¯ä»¥é€šè¿‡å¯¹carryè¢«10æ•´é™¤çš„ä½™æ•°æ¥å¾—çŸ¥å½“å‰èŠ‚ç‚¹çš„ä¸¤æ•°ç›¸åŠ æ˜¯å¦è¿›ä½ã€‚é€šè¿‡å¯¹sumçš„å€¼å¯¹10å–modï¼Œå¯ä»¥å¾—åˆ°åŠ äº†è¿›ä½åçš„å€¼ã€‚</p>
<p>ä¹‹åå°±æ˜¯åˆ›å»ºè¾…åŠ©èŠ‚ç‚¹é“¾çš„åä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶æŠŠcuræŒ‡å‘æ–°èŠ‚ç‚¹ã€‚å¦‚æœè¿™æ¬¡è¿ç®—æœ‰è¿›ä½ï¼Œåˆ™å†æ–°å¢ä¸€ä¸ªå€¼ä¸ºcarryçš„èŠ‚ç‚¹ã€‚ è¿™æ ·é‡å¤ç›´åˆ°l1 æˆ– l2åˆ°è¾¾é“¾å°¾ï¼Œå¦‚æœä¸åŒæ—¶åˆ°è¾¾é“¾å°¾ï¼Œåˆ™ç»“æœé“¾è¡¨ä¾æ¬¡æŠŠæœªåˆ°è¾¾é“¾å°¾çš„æ•°å¤åˆ¶ï¼Œæœ€ål1ï¼Œl2éƒ½åˆ°è¾¾é“¾å°¾ï¼Œè®¡ç®—ç»“æŸã€‚</p>
<h3 id="Reading"><a href="#Reading" class="headerlink" title="Reading"></a>Reading</h3><p><strong>Python at Netflix</strong></p>
<p><a href="https://medium.com/netflix-techblog/python-at-netflix-bba45dae649e" target="_blank" rel="noopener">https://medium.com/netflix-techblog/python-at-netflix-bba45dae649e</a></p>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº†Pythonåœ¨NetflixæŠ€æœ¯æ¶æ„ä¸­çš„åº”ç”¨ã€‚ç»™æƒ³è¦ç”¨Pythonæäº‹æƒ…çš„æœ‹å‹ä»¬ä¸€äº›æœ‰äº‹å®æ”¯æŒçš„æ€è·¯ã€‚</p>
<h3 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h3><p>æœ¬å‘¨åˆ†äº«ä¸€ä¸‹Javaå†…å­˜æ¨¡å‹çš„happen beforeåŸåˆ™</p>
<ol>
<li>ç¨‹åºæ¬¡åºè§„åˆ™ï¼šåœ¨ä¸€ä¸ªçº¿ç¨‹å†…ï¼ŒæŒ‰ç…§ç¨‹åºä»£ç é¡ºåºï¼Œä¹¦å†™åœ¨å‰é¢çš„æ“ä½œhappens beforeäºä¹¦å†™åœ¨åé¢çš„æ“ä½œã€‚å‡†ç¡®åœ°è¯´ï¼Œåº”è¯¥æ˜¯æ§åˆ¶æµé¡ºåºè€Œä¸æ˜¯ç¨‹åºä»£ç é¡ºåºï¼Œå› ä¸ºè¦è€ƒè™‘åˆ†æ”¯ã€å¾ªç¯ç­‰ç»“æ„ã€‚å¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹çš„æ“ä½œï¼Œé‚£ä¹ˆå‰ä¸€ä¸ªæ“ä½œçš„ç»“æœå¿…å®šå¯¹åç»­æ“ä½œå¯è§ã€‚</li>
<li>ç®¡ç¨‹é”å®šè§„åˆ™ï¼šä¸€ä¸ªunlockæ“ä½œhappens beforeäºåé¢å¯¹åŒä¸€ä¸ªé”çš„lockæ“ä½œã€‚è¿™é‡Œå¿…é¡»å¼ºè°ƒçš„æ˜¯åŒä¸€ä¸ªé”ï¼Œè€Œâ€åé¢â€æ˜¯æŒ‡æ—¶é—´ä¸Šçš„å…ˆåé¡ºåºã€‚æœ€å¸¸è§çš„å°±æ˜¯syncronized æ–¹æ³•å’Œsyncronizedä»£ç å—ã€‚</li>
<li>volatileå˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ªvolatileå˜é‡çš„å†™æ“ä½œhappens beforeäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œï¼Œè¿™é‡Œçš„â€åé¢â€åŒæ ·æ˜¯æŒ‡æ—¶é—´ä¸Šçš„å…ˆåé¡ºåºã€‚è¯¥è§„åˆ™åœ¨ConcurrentHashMap ä¸­è¯»æ“ä½œä¸éœ€è¦åŠ é”ä¸­æœ‰å¾ˆå¥½çš„ä½“ç°ã€‚</li>
<li>çº¿ç¨‹å¯åŠ¨è§„åˆ™ï¼šThreadå¯¹è±¡çš„start()æ–¹æ³•happens beforeäºæ­¤çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œã€‚</li>
<li>çº¿ç¨‹ç»ˆæ­¢è§„åˆ™ï¼šçº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºå¯¹æ­¤çº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Thread.joinï¼ˆï¼‰æ–¹æ³•ç»“æŸã€Thread.isAliveï¼ˆï¼‰çš„è¿”å›å€¼ç­‰æ‰‹æ®µæ£€æµ‹åˆ°çº¿ç¨‹å·²ç»ç»ˆæ­¢æ‰§è¡Œã€‚</li>
<li>çº¿ç¨‹ä¸­æ–­è§„åˆ™ï¼šå¯¹çº¿ç¨‹interrupt()æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿï¼Œå¯ä»¥é€šè¿‡Thread.interrupted()æ–¹æ³•æ£€æµ‹åˆ°æ˜¯å¦æœ‰ä¸­æ–­å‘ç”Ÿã€‚</li>
<li>å¯¹è±¡ç»ˆç»“è§„åˆ™ï¼šä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆ(æ„é€ å‡½æ•°æ‰§è¡Œç»“æŸ)å…ˆè¡Œå‘ç”Ÿäºå®ƒçš„finalize()æ–¹æ³•çš„å¼€å§‹ã€‚</li>
</ol>
<p>ä¼ é€’æ€§ï¼šå¦‚æœ A happens before Bï¼Œä¸”B happens before Cï¼Œåˆ™A happens before C</p>
<h3 id="Share"><a href="#Share" class="headerlink" title="Share"></a>Share</h3><p>æ‰“é€  Mac ä¸‹é«˜é¢œå€¼å¥½ç”¨çš„ç»ˆç«¯ç¯å¢ƒ</p>
<p><a href="https://blog.biezhi.me/2018/11/build-a-beautiful-mac-terminal-environment.html" target="_blank" rel="noopener">https://blog.biezhi.me/2018/11/build-a-beautiful-mac-terminal-environment.html</a></p>
]]></content>
      <categories>
        <category>ARTS</category>
      </categories>
      <tags>
        <tag>ARTS</tag>
      </tags>
  </entry>
  <entry>
    <title>ARTS-04</title>
    <url>/2019/08/02/ARTS-04/</url>
    <content><![CDATA[<h3 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h3><p>æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²(3)</p>
<p><strong>è§£æ³•1:</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @lc app=leetcode.cn id=3 lang=java</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [3] æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> l = s.length();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; l; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt;= l; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (allUnique(s, i, j)) &#123;</span><br><span class="line">                    result = Math.max(result, j - i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">allUnique</span><span class="params">(String s, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        Set&lt;Character&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = start; i &lt; end; i++) &#123;</span><br><span class="line">            Character c = s.charAt(i);</span><br><span class="line">            <span class="keyword">if</span> (!set.contains(c)) &#123;</span><br><span class="line">                set.add(c);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æš´åŠ›ç ´è§£æ³•æ²¡å•¥å¥½è¯´çš„, ç›´æ¥è¶…æ—¶äº†, æ˜¾ç„¶æ˜¯ä¸å¯è¡Œçš„.<br>æ—¶é—´å¤æ‚åº¦ï¼šO(n^3)</p>
<p><strong>è§£æ³•2:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>ARTS</category>
      </categories>
      <tags>
        <tag>ARTS</tag>
      </tags>
  </entry>
  <entry>
    <title>Java ä¸­æ¥å£ä¸æŠ½è±¡ç±»çš„åŒºåˆ«</title>
    <url>/2019/07/02/Java-%E4%B8%AD%E6%8E%A5%E5%8F%A3%E4%B8%8E%E6%8A%BD%E8%B1%A1%E7%B1%BB%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<h4 id="æŠ½è±¡ç±»ï¼š"><a href="#æŠ½è±¡ç±»ï¼š" class="headerlink" title="æŠ½è±¡ç±»ï¼š"></a>æŠ½è±¡ç±»ï¼š</h4><h5 id="å®šä¹‰ï¼š"><a href="#å®šä¹‰ï¼š" class="headerlink" title="å®šä¹‰ï¼š"></a>å®šä¹‰ï¼š</h5><p>å¦‚æœä¸€ä¸ªç±»æœ‰æŠ½è±¡æ–¹æ³•ï¼Œåˆ™ç§°è¿™ä¸ªç±»ä¸ºæŠ½è±¡ç±»ã€‚ä½¿ç”¨abstractä¿®é¥°æŠ½è±¡ç±»ã€‚<br>æŠ½è±¡ç±»ä¸­å¯èƒ½å«æœ‰æ— å…·ä½“å®ç°çš„æ–¹æ³•ï¼Œæ•…ä¸èƒ½ç”¨æŠ½è±¡ç±»åˆ›å»ºå¯¹è±¡ã€‚æŠ½è±¡æ–¹æ³•æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•ï¼Œåªæœ‰å£°æ˜ï¼Œæ²¡æœ‰å®ç°ã€‚å¦‚æœä¸€ä¸ªç±»ç»§æ‰¿æŠ½è±¡ç±»ï¼Œåˆ™å¿…é¡»å®ç°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•ï¼Œå¦‚æœä¸è¿™ä¹ˆåšï¼Œåˆ™æ­¤ç±»ä¹Ÿåº”è¯¥ä¸ºæŠ½è±¡ç±»ã€‚</p>
<h5 id="æŠ½è±¡ç±»ä¸æ™®é€šç±»çš„åŒºåˆ«"><a href="#æŠ½è±¡ç±»ä¸æ™®é€šç±»çš„åŒºåˆ«" class="headerlink" title="æŠ½è±¡ç±»ä¸æ™®é€šç±»çš„åŒºåˆ«"></a>æŠ½è±¡ç±»ä¸æ™®é€šç±»çš„åŒºåˆ«</h5><ol>
<li>æŠ½è±¡æ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦å¿…é¡»ä¸ºpublic æˆ–è€… protectedï¼ˆå¦‚æœä¸ºprivate åˆ™ä¸èƒ½è¢«å­ç±»ç»§æ‰¿ï¼Œå­ç±»æ— æ³•å®ç°è¯¥æ–¹æ³•ï¼‰ï¼Œé»˜è®¤ä¸ºpublicã€‚</li>
<li>æŠ½è±¡ç±»ä¸èƒ½ç”¨æ¥åˆ›å»ºå¯¹è±¡ã€‚</li>
<li>å¦‚æœä¸€ä¸ªç±»ç»§æ‰¿äºä¸€ä¸ªæŠ½è±¡ç±»ï¼Œåˆ™å­ç±»å¿…é¡»å®ç°çˆ¶ç±»çš„æ‰€æœ‰æŠ½è±¡æ–¹æ³•ã€‚å¦‚æœå­ç±»æ²¡æœ‰å®ç°ï¼Œåˆ™å¿…é¡»å®šä¹‰ä¸ºabstract classã€‚</li>
</ol>
<h4 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h4><p>å¯ä»¥å«æœ‰å˜é‡å’Œæ–¹æ³•ã€‚<br>ä½†æ˜¯æ¥å£ä¸­édefaultçš„æ–¹æ³•æ˜¯éšå¼æŠ½è±¡çš„,æ¥å£ä¸­çš„æ–¹æ³•ä¼šè¢«éšå¼çš„æŒ‡å®šä¸º public abstractï¼ˆåªèƒ½æ˜¯ public abstractï¼ˆ1.8ä»¥åå¯ä»¥æ˜¯defaultï¼‰ï¼Œå…¶ä»–ä¿®é¥°ç¬¦éƒ½ä¼šæŠ¥é”™ï¼‰ã€‚<br>æ¥å£ä¸­å¯ä»¥å«æœ‰å˜é‡ï¼Œä½†æ˜¯æ¥å£ä¸­çš„å˜é‡ä¼šè¢«éšå¼çš„æŒ‡å®šä¸º public static final å˜é‡ï¼ˆå¹¶ä¸”åªèƒ½æ˜¯ publicï¼Œç”¨ private ä¿®é¥°ä¼šæŠ¥ç¼–è¯‘é”™è¯¯ï¼‰ã€‚</p>
<h5 id="æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«"><a href="#æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«" class="headerlink" title="æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«"></a>æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«</h5><ol>
<li>æŠ½è±¡ç±»ä¸­çš„æ–¹æ³•å¯ä»¥æœ‰æ–¹æ³•ä½“ï¼Œå°±æ˜¯èƒ½å®ç°æ–¹æ³•çš„å…·ä½“åŠŸèƒ½ï¼Œä½†æ˜¯æ¥å£ä¸­çš„æ–¹æ³•ä¸è¡Œã€‚(Java 1.8ä»¥åæ¥å£å¯ä»¥æœ‰å¯ä»¥å®ç°çš„defaultæ–¹æ³•)</li>
<li>æŠ½è±¡ç±»ä¸­çš„æˆå‘˜å˜é‡å¯ä»¥æ˜¯å„ç§ç±»å‹çš„ï¼Œè€Œæ¥å£ä¸­çš„æˆå‘˜å˜é‡åªèƒ½æ˜¯ public static final ç±»å‹çš„ã€‚</li>
<li>æ¥å£ä¸­ä¸èƒ½å«æœ‰é™æ€ä»£ç å—ä»¥åŠé™æ€æ–¹æ³•(ç”¨ static ä¿®é¥°çš„æ–¹æ³•)ï¼Œè€ŒæŠ½è±¡ç±»æ˜¯å¯ä»¥æœ‰é™æ€ä»£ç å—å’Œé™æ€æ–¹æ³•ã€‚</li>
<li>ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè€Œä¸€ä¸ªç±»å´å¯ä»¥å®ç°å¤šä¸ªæ¥å£ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>interview</tag>
      </tags>
  </entry>
  <entry>
    <title>Java Exception &amp; Error</title>
    <url>/2019/05/22/Java-Exception-Error/</url>
    <content><![CDATA[<p>###java.lang.ClassNotFoundException</p>
<p>This exception indicates that the class was not found on the classpath. This indicates that we were trying to load the class definition, and the class did not exist on the classpath.</p>
<p>###java.lang.NoClassDefFoundError<br>This exception indicates that the JVM looked in its internal class definition data structure for the definition of a class and did not find it. This is different than saying that it could not be loaded from the classpath. Usually this indicates that we previously attempted to load a class from the classpath, but it failed for some reason - now weâ€™re trying to use the class again (and thus need to load it, since it failed last time), but weâ€™re not even going to try to load it, because we failed loading it earlier (and reasonably suspect that we would fail again). The earlier failure could be a ClassNotFoundException or an ExceptionInInitializerError (indicating a failure in the static initialization block) or any number of other problems. The point is, a NoClassDefFoundError is not necessarily a classpath problem.</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Rediså…«è‚¡æ–‡</title>
    <url>/2020/09/03/Redis%E5%85%AB%E8%82%A1%E6%96%87/</url>
    <content><![CDATA[<h2 id="åº”ç”¨ç¯‡"><a href="#åº”ç”¨ç¯‡" class="headerlink" title="åº”ç”¨ç¯‡"></a>åº”ç”¨ç¯‡</h2><ol>
<li>Redis æœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Œåˆ†åˆ«æœ‰ä»€ä¹ˆä½¿ç”¨åœºæ™¯ï¼Ÿ</li>
<li>Redis ZSET ç›¸åŒ score å¦‚ä½•æ’åºï¼Ÿ</li>
<li>åœ¨çˆ¬è™«ä¸­ï¼Œå¦‚ä½•ä½¿ç”¨ Redis åš URL å»é‡ï¼Ÿ</li>
<li>Redis æ˜¯å¦æ”¯æŒäº‹åŠ¡ï¼Ÿ</li>
<li>Redis ä¸­çš„ WATCH å‘½ä»¤æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ</li>
<li>Redis æ˜¯å¦‚ä½•ä¿è¯é«˜å¯ç”¨çš„ï¼Ÿ</li>
<li>å¦‚ä½•ä½¿ç”¨ Redis æ¥å®ç°åˆ†å¸ƒå¼é”ï¼ŸRedlockï¼Ÿ</li>
</ol>
]]></content>
      <categories>
        <category>redis</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Soul ç½‘å…³æºç åˆ†æï¼ˆäºŒï¼‰divide, rewrite æ’ä»¶</title>
    <url>/2021/01/16/Soul-%E7%BD%91%E5%85%B3%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%BA%8C%EF%BC%89divide-rewrite-%E6%8F%92%E4%BB%B6/</url>
    <content><![CDATA[<p>åœ¨ä¸Šä¸€èŠ‚é‡Œæˆ‘ä»¬ç¼–è¯‘å¥½äº† Soul ç½‘å…³çš„æºç ï¼Œä»Šå¤©æˆ‘ä»¬ä»rewriteæ’ä»¶å¼€å§‹å­¦ä¹ å¦‚ä½•å¯¹æœåŠ¡è¿›è¡Œä»£ç†å¹¶é‡å†™è·¯å¾„ã€‚</p>
<a id="more"></a>

<p>é¦–å…ˆæˆ‘ä»¬ç”¨Pythonå†™ä¸€ä¸ªç®€å•çš„Flaskåº”ç”¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/foo/bar/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello World!'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨æœåŠ¡åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç°åœ¨è®¾ç½®çš„è·¯å¾„ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:5000&#x2F;foo&#x2F;bar&#x2F;</span><br></pre></td></tr></table></figure>
<p>å°è¯•ä½¿ç”¨ curl è®¿é—®å¯¹åº”çš„æ¥å£ï¼š<br><img src="https://img-blog.csdnimg.cn/20210115211421555.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>OKï¼ŒæœåŠ¡æ­£å¸¸ã€‚</p>
<p>æˆ‘ä»¬åœ¨ soul-admin é€‰æ‹© <strong>rewrite</strong> æ’ä»¶ï¼Œç‚¹å‡»æ·»åŠ é€‰æ‹©å™¨ï¼š<br><img src="https://img-blog.csdnimg.cn/20210115210809657.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="é€‰æ‹©æ·»åŠ é€‰æ‹©å™¨"><br>åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­è¾“å…¥ï¼š<br><img src="https://img-blog.csdnimg.cn/20210115211626802.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç‚¹å‡»ç¡®è®¤åï¼Œé€šè¿‡ Chrome debug å¯ä»¥æ•è·åˆ°å‰ç«¯å‘èµ·çš„ä¸‰ä¸ªè¯·æ±‚ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ol>
<li>/selector</li>
<li>/selector?pluginId=3&amp;currentPage=1&amp;pageSize=12</li>
<li>/rule?currentPage=1&amp;pageSize=12&amp;selectorId=1350069791219036160</li>
</ol>
<p>æˆ‘ä»¬è¿½è¸ªåˆ°å¯¹åº”çš„æºç å¯ä»¥çœ‹åˆ°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * query Selectors.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pluginId    plugin id.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> currentPage current page.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageSize    page size.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@linkplain</span> SoulAdminResult&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">""</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> SoulAdminResult <span class="title">querySelectors</span><span class="params">(<span class="keyword">final</span> String pluginId, <span class="keyword">final</span> Integer currentPage, <span class="keyword">final</span> Integer pageSize)</span> </span>&#123;</span><br><span class="line">    CommonPager&lt;SelectorVO&gt; commonPager = selectorService.listByPage(<span class="keyword">new</span> SelectorQuery(pluginId, <span class="keyword">new</span> PageParameter(currentPage, pageSize)));</span><br><span class="line">    <span class="keyword">return</span> SoulAdminResult.success(SoulResultMessage.QUERY_SUCCESS, commonPager);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‰ä¸¤ä¸ªè¯·æ±‚å…¶å®æ˜¯åœ¨åŠ è½½æˆ‘ä»¬å³ä¾§çš„é€‰æ‹©å™¨ï¼Œç°åœ¨æˆ‘ä»¬æ²¡æœ‰åˆ›å»ºé€‰æ‹©å™¨ï¼Œæ‰€ä»¥ä»€ä¹ˆä¹Ÿæ²¡æœ‰ã€‚<br>è€Œ /rule è¿™ä¸ªè¯·æ±‚æ˜¯åœ¨æŸ¥è¯¢ç°æœ‰çš„è§„åˆ™åˆ—è¡¨ã€‚</p>
<p>ç‚¹å‡»å³ä¾§çš„â€œåˆ›å»ºé€‰æ‹©å™¨â€æŒ‰é’®æ¥åˆ›å»ºé€‰æ‹©å™¨ï¼š<br><img src="https://img-blog.csdnimg.cn/20210115213000568.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆ›å»ºå¥½é€‰æ‹©å™¨åï¼Œç”±äºæˆ‘ä»¬ä»…ä»…æ˜¯æŠŠé€‰æ‹©å™¨çš„æ•°æ®å­˜æ”¾åœ¨äº† æ•°æ®åº“ä¸­ï¼ˆæ ¹æ®ä½ é…ç½®å¯èƒ½åœ¨ MySQL æˆ– H2é‡Œï¼‰ï¼Œæˆ‘ä»¬å¦‚æœéœ€è¦ä»–å³æ—¶ç”Ÿæ•ˆéœ€è¦ç‚¹å‡»åŒæ­¥è‡ªå®šä¹‰rewriteã€‚<br><img src="https://img-blog.csdnimg.cn/20210115213237513.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ¥å£è°ƒç”¨è·¯å¾„æ˜¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:9095&#x2F;plugin&#x2F;syncPluginData&#x2F;3</span><br></pre></td></tr></table></figure>
<p>è¿”å› â€œsync successâ€ï¼Œæˆ‘ä»¬å†æ¬¡åˆ‡æ¢åˆ°æºç ï¼š<br><img src="https://img-blog.csdnimg.cn/20210115213635126.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å‘ç° soul-admin ç”¨åˆ°äº†Spring ä¸­çš„ ApplicationEventPublisherï¼Œåœ¨å¦‚ä¸‹è·¯å¾„çš„ç±»ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ‰¾åˆ°äº†soul-adminå¤„ç†è¿™äº›æ—¶é—´çš„é€»è¾‘ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">org&#x2F;dromara&#x2F;soul&#x2F;admin&#x2F;listener&#x2F;DataChangedEventDispatcher.java</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20210115214219112.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åˆšåˆšæˆ‘ä»¬åº”è¯¥æ˜¯é€šè¿‡ç‚¹å‡»æŒ‰é’®è§¦å‘äº† â€œonPluginChangedâ€ è¿™ä¸ªäº‹ä»¶ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ ¹æ®æˆ‘ä»¬æ‰€é…ç½®çš„æ•°æ®åŒæ­¥ä¾§å½•é¢ï¼Œsoul æä¾›äº†ä¸‰ç§å®ç°æ–¹å¼ï¼š<br><img src="https://img-blog.csdnimg.cn/20210115214458570.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<ol>
<li><p>WebSocket<br> åœ¨ WebsocketDataChangedListener ä¸­è°ƒç”¨ onPluginChanged æ–¹æ³•æ¥å‘ SoulBootstrapApplication å‘é€JSONåºåˆ—åŒ–åçš„æ¶ˆæ¯ã€‚</p>
</li>
<li><p>Nacos<br> å¦‚æœé…ç½® Nacos è¿›è¡ŒåŒæ­¥ï¼Œåˆ™æ˜¯é€šè¿‡ ConfigService æ¥å‘é€æ¶ˆæ¯ã€‚</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPluginChanged</span><span class="params">(<span class="keyword">final</span> List&lt;PluginData&gt; changed, <span class="keyword">final</span> DataEventTypeEnum eventType)</span> </span>&#123;</span><br><span class="line">     updatePluginMap(getConfig(PLUGIN_DATA_ID));</span><br><span class="line">     <span class="keyword">switch</span> (eventType) &#123;</span><br><span class="line">         <span class="keyword">case</span> DELETE:</span><br><span class="line">             changed.forEach(plugin -&gt; PLUGIN_MAP.remove(plugin.getName()));</span><br><span class="line">             <span class="keyword">break</span>;</span><br><span class="line">         <span class="keyword">case</span> REFRESH:</span><br><span class="line">         <span class="keyword">case</span> MYSELF:</span><br><span class="line">             Set&lt;String&gt; set = <span class="keyword">new</span> HashSet&lt;&gt;(PLUGIN_MAP.keySet());</span><br><span class="line">             changed.forEach(plugin -&gt; &#123;</span><br><span class="line">                 set.remove(plugin.getName());</span><br><span class="line">                 PLUGIN_MAP.put(plugin.getName(), plugin);</span><br><span class="line">             &#125;);</span><br><span class="line">             PLUGIN_MAP.keySet().removeAll(set);</span><br><span class="line">             <span class="keyword">break</span>;</span><br><span class="line">         <span class="keyword">default</span>:</span><br><span class="line">             changed.forEach(plugin -&gt; PLUGIN_MAP.put(plugin.getName(), plugin));</span><br><span class="line">             <span class="keyword">break</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     publishConfig(PLUGIN_DATA_ID, PLUGIN_MAP);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>ZooKeeper<br>  é€šè¿‡èŠ‚ç‚¹åŒæ­¥æ•°æ®ã€‚</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPluginChanged</span><span class="params">(<span class="keyword">final</span> List&lt;PluginData&gt; changed, <span class="keyword">final</span> DataEventTypeEnum eventType)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">for</span> (PluginData data : changed) &#123;</span><br><span class="line">           <span class="keyword">final</span> String pluginPath = ZkPathConstants.buildPluginPath(data.getName());</span><br><span class="line">           <span class="comment">// delete</span></span><br><span class="line">           <span class="keyword">if</span> (eventType == DataEventTypeEnum.DELETE) &#123;</span><br><span class="line">               deleteZkPathRecursive(pluginPath);</span><br><span class="line">               <span class="keyword">final</span> String selectorParentPath = ZkPathConstants.buildSelectorParentPath(data.getName());</span><br><span class="line">               deleteZkPathRecursive(selectorParentPath);</span><br><span class="line">               <span class="keyword">final</span> String ruleParentPath = ZkPathConstants.buildRuleParentPath(data.getName());</span><br><span class="line">               deleteZkPathRecursive(ruleParentPath);</span><br><span class="line">               <span class="keyword">continue</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//create or update</span></span><br><span class="line">           upsertZkNode(pluginPath, data);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥é€šè¿‡å¯¹æŒ‡å®šæ¥å£å‘èµ· POST è¯·æ±‚æ¥æ³¨å†Œå…¶ä»–è¯­è¨€çš„æœåŠ¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;appName&quot;: &quot;xxx&quot;, &#x2F;&#x2F;åº”ç”¨åç§° å¿…å¡«</span><br><span class="line">	&quot;context&quot;: &quot;&#x2F;xxx&quot;, &#x2F;&#x2F;è¯·æ±‚å‰ç¼€ å¿…å¡«</span><br><span class="line">	&quot;path&quot;: &quot;xxx&quot;, &#x2F;&#x2F;è·¯å¾„éœ€è¦å”¯ä¸€ å¿…å¡«</span><br><span class="line">	&quot;pathDesc&quot;: &quot;xxx&quot;, &#x2F;&#x2F;è·¯å¾„æè¿°</span><br><span class="line">	&quot;rpcType&quot;: &quot;http&quot;, &#x2F;&#x2F;rpcç±»å‹  å¿…å¡«</span><br><span class="line">	&quot;host&quot;: &quot;xxx&quot;, &#x2F;&#x2F;æœåŠ¡host å¿…å¡«</span><br><span class="line">	&quot;port&quot;: xxx, &#x2F;&#x2F;æœåŠ¡ç«¯å£ å¿…å¡«</span><br><span class="line">	&quot;ruleName&quot;: &quot;xxx&quot;, &#x2F;&#x2F;å¯ä»¥åŒpathä¸€æ ·  å¿…å¡«</span><br><span class="line">	&quot;enabled&quot;: &quot;true&quot;, &#x2F;&#x2F;æ˜¯å¦å¼€å¯</span><br><span class="line">	&quot;registerMetaData&quot;: &quot;true&quot; &#x2F;&#x2F;æ˜¯å¦éœ€è¦æ³¨å†Œå…ƒæ•°æ®</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¯·æ±‚åœ°å€ï¼šhttp:&#x2F;&#x2F;&#123;ip&#125;:&#123;port&#125;&#x2F;soul-client&#x2F;springmvc-register è¯·è‡ªè¡Œè¾“å…¥soul-admin çš„ IP å’Œ PORT</span><br></pre></td></tr></table></figure>
<p>åœ¨ postman æˆ–å…¶ä»–å·¥å…·ä¸­æˆåŠŸæ³¨å†ŒæœåŠ¡ï¼š<br><img src="https://img-blog.csdnimg.cn/20210116013439579.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä½†æˆ‘ä»¬å‘ç°å¹¶ä¸èƒ½ç›´æ¥é€šè¿‡ soul æ¥ä»£ç†æˆ‘ä»¬çš„ flask æœåŠ¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  ~ curl http:&#x2F;&#x2F;localhost:9195</span><br><span class="line">&#123;&quot;code&quot;:-107,&quot;message&quot;:&quot;Can not find selector, please check your configuration!&quot;,&quot;data&quot;:null&#125;%</span><br></pre></td></tr></table></figure>
<p>ä»”ç»†æŸ¥çœ‹æ–‡æ¡£åï¼Œå‘ç°éœ€è¦å…ˆè®¾ç½® Divide æ’ä»¶å¹¶æ·»åŠ å¯¹åº”çš„selectorã€‚<br><img src="https://img-blog.csdnimg.cn/20210116014205816.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>é…ç½®å®Œæˆåå¯ä»¥çœ‹åˆ° divide æ’ä»¶æˆåŠŸé€‰å–åˆ°äº† æˆ‘ä»¬é…ç½®çš„ test1 selectorï¼Œä½†æ˜¯æˆ‘ä»¬çš„è¯·æ±‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;localhost:9195&#x2F;foo&#x2F;bar&#x2F;</span><br></pre></td></tr></table></figure>
<p>è¢«è§£ææˆäº† <a href="http://127.0.0.1:5000/bar/ï¼Œä¸€å®šæ˜¯ä»€ä¹ˆåœ°æ–¹å‡ºäº†é—®é¢˜ã€‚" target="_blank" rel="noopener">http://127.0.0.1:5000/bar/ï¼Œä¸€å®šæ˜¯ä»€ä¹ˆåœ°æ–¹å‡ºäº†é—®é¢˜ã€‚</a><br>å†çœ‹çœ‹æºç <br><img src="https://img-blog.csdnimg.cn/20210116015548504.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ä»¬å‘ç° åœ¨ org/dromara/soul/plugin/divide/DividePlugin.java è¿™ä¸ªç±»ä¸­ buildRealURL ä¼šå°†æˆ‘ä»¬çš„ â€œ/fooâ€ è¯†åˆ«ä¸º moduleï¼Œç„¶åæŠŠâ€œ/barâ€ è¯†åˆ«ä¸ºçœŸå®çš„request pathï¼Œæ‰€ä»¥å¯¼è‡´äº†åˆšåˆšçš„é—®é¢˜ã€‚<br>å†æ¬¡å°è¯•åœ¨å‰é¢åŠ ä¸€å±‚ï¼ŒæˆåŠŸäº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  ~ curl http:&#x2F;&#x2F;localhost:9195&#x2F;1&#x2F;foo&#x2F;bar&#x2F;</span><br><span class="line">Hello World!%</span><br></pre></td></tr></table></figure>

</li>
</ol>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Soul</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue.jsåŒå‘æ•°æ®ç»‘å®šæ¢ç©¶</title>
    <url>/2018/08/03/Vue-js%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E6%8E%A2%E7%A9%B6/</url>
    <content><![CDATA[<p>åœ¨æœ€è¿‘çš„å‰ç«¯é¢è¯•ä¸­ï¼Œvue.jsçš„åŒå‘æ•°æ®ç»‘å®šåŸºæœ¬æ˜¯æˆ‘å¿…é—®çš„ã€‚ä¸‹é¢æˆ‘ä»¬å°±ä¸€èµ·æ¢ç©¶ä¸‹å…¶åŸç†ã€‚</p>
<a id="more"></a>

<p><img src="https://i.imgur.com/bKNikGl.jpg" alt=""></p>
<ol>
<li>åŸç†<br>Vue.jsåŒå‘æ•°æ®ç»‘å®šçš„åŸç†ä¸»è¦æ˜¯é€šè¿‡ <strong>Objectå¯¹è±¡çš„definePropertyæ–¹æ³•ï¼Œé‡å†™dataçš„setå’Œgetå‡½æ•°</strong> æ¥å®ç°çš„ã€‚<br>ä»¥ä¸‹æ˜¯defineProperty()çš„è¯­æ³•<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Object.defineProperty(obj, prop, descriptor)</span><br></pre></td></tr></table></figure>
è¿™ä¸ªæ–¹æ³•çš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼š</li>
</ol>
<ul>
<li>obj<br>è¦åœ¨å…¶ä¸Šå®šä¹‰å±æ€§çš„å¯¹è±¡ã€‚</li>
<li>prop<br>è¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„åç§°ã€‚</li>
<li>descriptor<br>å°†è¢«å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§æè¿°ç¬¦ã€‚</li>
</ul>
<p>æ–¹æ³•ç›¸å…³çš„å°±ä¸åœ¨è¿™é‡Œè®¨è®ºï¼Œè¯¦è§ï¼š<br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty</a></p>
]]></content>
      <categories>
        <category>frontend</category>
      </categories>
      <tags>
        <tag>Vue.js</tag>
      </tags>
  </entry>
  <entry>
    <title>hello_world</title>
    <url>/2018/04/15/hello-world/</url>
    <content><![CDATA[<h4 id="ç»ˆäºæœ‰äº†è‡ªå·±çš„åšå®¢äº†"><a href="#ç»ˆäºæœ‰äº†è‡ªå·±çš„åšå®¢äº†" class="headerlink" title="ç»ˆäºæœ‰äº†è‡ªå·±çš„åšå®¢äº†"></a>ç»ˆäºæœ‰äº†è‡ªå·±çš„åšå®¢äº†</h4>]]></content>
      <tags>
        <tag>mixture</tag>
      </tags>
  </entry>
  <entry>
    <title>mysqlç”Ÿæˆæ‰¹é‡è¯­å¥</title>
    <url>/2018/04/28/mysql%E7%94%9F%E6%88%90%E6%89%B9%E9%87%8F%E8%AF%AD%E5%8F%A5/</url>
    <content><![CDATA[<p>ä»Šå¤©é‡åˆ°ç›‘æ§ç³»ç»Ÿçš„è¡¨æ ¼å¤ªå¤šçš„é—®é¢˜, ä¸ºäº†èŠ‚çº¦æ—¶é—´, åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ç”Ÿæˆæ‰¹é‡åˆ é™¤è¡¨çš„è¯­å¥:</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT CONCAT( &#39;drop table &#39;, table_name, &#39;;&#39; )</span><br><span class="line">FROM information_schema.tables</span><br><span class="line">WHERE table_name LIKE &#39;pre_%&#39;;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å¯ä»¥æ‰¹é‡ç”Ÿæˆdrop è¯­å¥, ä½¿ç”¨navicatæ‰§è¡Œå³å¯.</p>
<h3 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……:"></a>è¡¥å……:</h3><p>ååˆ†é’Ÿäº†ç»“MySQL information_schema</p>
<p><a href="https://www.cnblogs.com/shengdimaya/p/6920677.html" target="_blank" rel="noopener">https://www.cnblogs.com/shengdimaya/p/6920677.html</a></p>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>php åœ¨Windowså¼€å‘ä¸‹é‡åˆ°çš„å‘</title>
    <url>/2018/04/15/php-%E5%9C%A8Windows%E5%BC%80%E5%8F%91%E4%B8%8B%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/</url>
    <content><![CDATA[<p>åœ¨æœ¬åœ°è°ƒè¯•phpé€šè¿‡ä½¿ç”¨phpçš„curl è°ƒç”¨Thrift rpc æœåŠ¡æ—¶, ä½¿ç”¨äº†curl, ä½†æ˜¯ä¸€ç›´å‡ºç°è¶…æ—¶çš„ç°è±¡,ä¸€ç›´åˆ°è¶…è¿‡è¯·æ±‚æ‰€é™„å¸¦çš„è¶…æ—¶æ—¶é—´, è¿™ä¸ªæ˜¯å› ä¸ºWindowsä¸‹çš„phpæ˜¯ä»¥php-cgiè¿›ç¨‹çš„å½¢å¼è¿è¡Œçš„.</p>
<a id="more"></a>

<p>æˆ‘çš„phpé¡¹ç›®çš„fastcig-passçš„è®¾ç½®ä¸º(127.0.0.1:9000)ã€‚</p>
<p>é»˜è®¤è®¾ç½®æ˜¯ä»¥keepaliveæ–¹å¼è¯·æ±‚ï¼Œæ¥æ”¶åˆ°PHPæ–‡ä»¶æ—¶,äº¤ä¸php-cgiè§£æå¤„ç†,ç­‰å¾…å“åº”ã€‚</p>
<p>è€Œåœ¨æœ¬åœ°æ–‡ä»¶ä»¥CURLè¯·æ±‚æœ¬åœ°ç¯å¢ƒä¸­PHPæ–‡ä»¶æ—¶,ä¹‹å‰çš„PHPè¿˜åœ¨ç­‰å¾…CURLåçš„ç»“æœï¼Œè¿™æ—¶9000ç«¯å£å·²ç»è¢«å ç”¨.å¯¼è‡´CURLä¸€ç›´åœ¨å¤„äºç­‰å¾…çŠ¶æ€.</p>
<p>curl å…¶ä¸­ä¸€é¡¹è®¾ç½®: </p>
<p>curl_setopt($ch, CURLOPT_TIMEOUT, 5);</p>
<p>å½“åˆ°è¾¾5ç§’å, curl è¢«å¼ºåˆ¶ä¸­æ–­, åè€Œæ”¶åˆ°äº†RPCä¼ æ¥çš„response</p>
<p>åœ¨æŸ¥é˜…èµ„æ–™å, æˆ‘å‘ç°Windows ä¸­php-cgiå¹¶ä¸èƒ½åƒLinuxç¯å¢ƒä¸‹çš„php-fpm é‚£æ ·è‡ªå·±åˆ›å»ºæ–°çš„è¿›ç¨‹, åªèƒ½é€šè¿‡commandçš„æ–¹å¼å¯åŠ¨ä¸¤ä¸ªè¿›ç¨‹â€¦</p>
<p><strong>æˆ‘çš„è§£å†³æ–¹æ¡ˆ</strong></p>
<p>æŠŠphpå®¢æˆ·ç«¯çš„fastcgi_pass è®¾ç½®ä¸ºäº†127.0.0.1:9004</p>
<p>æ‰“å¼€ä¸¤ä¸ªcmd åˆ†åˆ«åœ¨phpæ ¹ç›®å½•ä¸‹æ‰§è¡Œè¿™ä¸¤ä¸ªå‘½ä»¤:</p>
<ol>
<li>php-cgi.exe -b 127.0.0.1:9000 -c php.ini </li>
<li>php-cgi.exe -b 127.0.0.1:9004 -c php.ini </li>
</ol>
<p>ä½†æ˜¯cmd å‘½ä»¤çª—å£ä¸èƒ½å…³é—­ã€‚</p>
<p>é—®é¢˜è§£å†³.</p>
]]></content>
      <categories>
        <category>PHP</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>traps</tag>
      </tags>
  </entry>
  <entry>
    <title>Soul ç½‘å…³æºç åˆ†æï¼ˆä¸‰ï¼‰dubbo æ’ä»¶</title>
    <url>/2021/01/17/Soul-%E7%BD%91%E5%85%B3%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%B8%89%EF%BC%89dubbo-%E6%8F%92%E4%BB%B6/</url>
    <content><![CDATA[<p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°è¯•ä½¿ç”¨divideæ’ä»¶è¿›è¡Œhttpä»£ç†ï¼Œä»Šå¤©æˆ‘ä»¬æ¥çœ‹çœ‹Soulæ˜¯å¦‚ä½•å°†httpåè®®ï¼Œè½¬æ¢æˆdubboåè®®çš„ã€‚</p>
<a id="more"></a>

<p>é¦–å…ˆåœ¨æ’ä»¶ç®¡ç†ä¸­å¼€å¯dubboé…ç½®ï¼š<br><img src="https://img-blog.csdnimg.cn/20210117003330559.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ‰“å¼€Soul æºç ï¼Œç¼–è¯‘ä¸‹å›¾è·¯å¾„çš„dubbo demo é¡¹ç›®ï¼š<br><img src="https://img-blog.csdnimg.cn/20210117003428606.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç¼–è¯‘åæˆ‘ä»¬æŠŠæ‰“åŒ…å¥½çš„ Jar åŒ…runèµ·æ¥ï¼Œ<br>ç¡®ä¿</p>
<ol>
<li>dubbo æ’ä»¶å·²å¼€å¯</li>
<li>ä½ çš„soul-bootstrapï¼Œsoul-admin åœ¨è¿è¡ŒçŠ¶æ€</li>
<li>zookeeper ä¹Ÿåœ¨å¯åŠ¨çŠ¶æ€ï¼ˆé»˜è®¤ç«¯å£2181ï¼‰ï¼Œåœ°å€åœ¨ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">soul&#x2F;soul-examples&#x2F;soul-examples-dubbo&#x2F;soul-examples-alibaba-dubbo-service&#x2F;target&#x2F;soul-examples-alibaba-dubbo-service-2.1.0.jar</span><br></pre></td></tr></table></figure>
æˆåŠŸè¿è¡Œdubbo demo åï¼Œå‘ç°soul admin å¸®æˆ‘ä»¬æ³¨å†Œäº†å…¶ä¸­çš„ endpoints<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2021-01-17 00:51:50.563  INFO 63416 --- [-47-EventThread] o.a.c.f.state.ConnectionStateManager     : State change: CONNECTED</span><br><span class="line">2021-01-17 00:51:50.590  INFO 63416 --- [-47-EventThread] o.a.c.framework.imps.EnsembleTracker     : New config event received: &#123;&#125;</span><br><span class="line">2021-01-17 00:51:50.590  INFO 63416 --- [-47-EventThread] o.a.c.framework.imps.EnsembleTracker     : New config event received: &#123;&#125;</span><br><span class="line">2021-01-17 00:51:50.973  INFO 63416 --- [ctReadThread-47] o.d.s.p.a.d.c.ApplicationConfigCache     : init aliaba dubbo reference success there meteData is :MetaData(id&#x3D;1350397137501040640, appName&#x3D;dubbo, contextPath&#x3D;null, path&#x3D;&#x2F;dubbo&#x2F;insert, rpcType&#x3D;dubbo, serviceName&#x3D;org.dromara.soul.examples.dubbo.api.service.DubboTestService, methodName&#x3D;insert, parameterTypes&#x3D;org.dromara.soul.examples.dubbo.api.entity.DubboTest, rpcExt&#x3D;&#123;&quot;group&quot;:&quot;&quot;,&quot;version&quot;:&quot;&quot;,&quot;loadbalance&quot;:&quot;random&quot;,&quot;retries&quot;:2,&quot;timeout&quot;:10000,&quot;url&quot;:&quot;&quot;&#125;, enabled&#x3D;true)</span><br><span class="line">2021-01-17 00:51:50.993  INFO 63416 --- [ctReadThread-47] o.d.s.p.a.d.c.ApplicationConfigCache     : init aliaba dubbo reference success there meteData is :MetaData(id&#x3D;1350397138167934976, appName&#x3D;dubbo, contextPath&#x3D;null, path&#x3D;&#x2F;dubbo&#x2F;findAll, rpcType&#x3D;dubbo, serviceName&#x3D;org.dromara.soul.examples.dubbo.api.service.DubboTestService, methodName&#x3D;findAll, parameterTypes&#x3D;null, rpcExt&#x3D;&#123;&quot;group&quot;:&quot;&quot;,&quot;version&quot;:&quot;&quot;,&quot;loadbalance&quot;:&quot;random&quot;,&quot;retries&quot;:2,&quot;timeout&quot;:10000,&quot;url&quot;:&quot;&quot;&#125;, enabled&#x3D;true)</span><br><span class="line">2021-01-17 00:51:51.012  INFO 63416 --- [ctReadThread-47] o.d.s.p.a.d.c.ApplicationConfigCache     : init aliaba dubbo reference success there meteData is :MetaData(id&#x3D;1350397138960658432, appName&#x3D;dubbo, contextPath&#x3D;null, path&#x3D;&#x2F;dubbo&#x2F;findById, rpcType&#x3D;dubbo, serviceName&#x3D;org.dromara.soul.examples.dubbo.api.service.DubboTestService, methodName&#x3D;findById, parameterTypes&#x3D;java.lang.String, rpcExt&#x3D;&#123;&quot;group&quot;:&quot;&quot;,&quot;version&quot;:&quot;&quot;,&quot;loadbalance&quot;:&quot;random&quot;,&quot;retries&quot;:2,&quot;timeout&quot;:10000,&quot;url&quot;:&quot;&quot;&#125;, enabled&#x3D;true)</span><br><span class="line">2021-01-17 00:51:51.060  INFO 63416 --- [ctReadThread-47] o.d.s.p.a.d.c.ApplicationConfigCache     : init aliaba dubbo reference success there meteData is :MetaData(id&#x3D;1350397139031961600, appName&#x3D;dubbo, contextPath&#x3D;null, path&#x3D;&#x2F;dubbo&#x2F;findByIdsAndName, rpcType&#x3D;dubbo, serviceName&#x3D;org.dromara.soul.examples.dubbo.api.service.DubboMultiParamService, methodName&#x3D;findByIdsAndName, parameterTypes&#x3D;java.util.List,java.lang.String, rpcExt&#x3D;&#123;&quot;group&quot;:&quot;&quot;,&quot;version&quot;:&quot;&quot;,&quot;loadbalance&quot;:&quot;random&quot;,&quot;retries&quot;:2,&quot;timeout&quot;:10000,&quot;url&quot;:&quot;&quot;&#125;, enabled&#x3D;true)</span><br><span class="line">2021-01-17 00:51:51.079  INFO 63416 --- [ctReadThread-47] o.d.s.p.a.d.c.ApplicationConfigCache     : init aliaba dubbo reference success there meteData is :MetaData(id&#x3D;1350397139103264768, appName&#x3D;dubbo, contextPath&#x3D;null, path&#x3D;&#x2F;dubbo&#x2F;findByArrayIdsAndName, rpcType&#x3D;dubbo, serviceName&#x3D;org.dromara.soul.examples.dubbo.api.service.DubboMultiParamService, methodName&#x3D;findByArrayIdsAndName, parameterTypes&#x3D;[Ljava.lang.Integer;,java.lang.String, rpcExt&#x3D;&#123;&quot;group&quot;:&quot;&quot;,&quot;version&quot;:&quot;&quot;,&quot;loadbalance&quot;:&quot;random&quot;,&quot;retries&quot;:2,&quot;timeout&quot;:10000,&quot;url&quot;:&quot;&quot;&#125;, enabled&#x3D;true)</span><br><span class="line">2021-01-17 00:51:51.100  INFO 63416 --- [ctReadThread-47] o.d.s.p.a.d.c.ApplicationConfigCache     : init aliaba dubbo reference success there meteData is :MetaData(id&#x3D;1350397139182956544, appName&#x3D;dubbo, contextPath&#x3D;null, path&#x3D;&#x2F;dubbo&#x2F;findByStringArray, rpcType&#x3D;dubbo, serviceName&#x3D;org.dromara.soul.examples.dubbo.api.service.DubboMultiParamService, methodName&#x3D;findByStringArray, parameterTypes&#x3D;[Ljava.lang.String;, rpcExt&#x3D;&#123;&quot;group&quot;:&quot;&quot;,&quot;version&quot;:&quot;&quot;,&quot;loadbalance&quot;:&quot;random&quot;,&quot;retries&quot;:2,&quot;timeout&quot;:10000,&quot;url&quot;:&quot;&quot;&#125;, enabled&#x3D;true)</span><br><span class="line">2021-01-17 00:51:51.126  INFO 63416 --- [ctReadThread-47] o.d.s.p.a.d.c.ApplicationConfigCache     : init aliaba dubbo reference success there meteData is :MetaData(id&#x3D;1350397139258454016, appName&#x3D;dubbo, contextPath&#x3D;null, path&#x3D;&#x2F;dubbo&#x2F;findByListId, rpcType&#x3D;dubbo, serviceName&#x3D;org.dromara.soul.examples.dubbo.api.service.DubboMultiParamService, methodName&#x3D;findByListId, parameterTypes&#x3D;java.util.List, rpcExt&#x3D;&#123;&quot;group&quot;:&quot;&quot;,&quot;version&quot;:&quot;&quot;,&quot;loadbalance&quot;:&quot;random&quot;,&quot;retries&quot;:2,&quot;timeout&quot;:10000,&quot;url&quot;:&quot;&quot;&#125;, enabled&#x3D;true)</span><br><span class="line">2021-01-17 00:51:51.153  INFO 63416 --- [ctReadThread-47] o.d.s.p.a.d.c.ApplicationConfigCache     : init aliaba dubbo reference success there meteData is :MetaData(id&#x3D;1350397139346534400, appName&#x3D;dubbo, contextPath&#x3D;null, path&#x3D;&#x2F;dubbo&#x2F;batchSave, rpcType&#x3D;dubbo, serviceName&#x3D;org.dromara.soul.examples.dubbo.api.service.DubboMultiParamService, methodName&#x3D;batchSave, parameterTypes&#x3D;java.util.List, rpcExt&#x3D;&#123;&quot;group&quot;:&quot;&quot;,&quot;version&quot;:&quot;&quot;,&quot;loadbalance&quot;:&quot;random&quot;,&quot;retries&quot;:2,&quot;timeout&quot;:10000,&quot;url&quot;:&quot;&quot;&#125;, enabled&#x3D;true)</span><br><span class="line">2021-01-17 00:51:51.169  INFO 63416 --- [ctReadThread-47] o.d.s.p.a.d.c.ApplicationConfigCache     : init aliaba dubbo reference success there meteData is :MetaData(id&#x3D;1350397139413643264, appName&#x3D;dubbo, contextPath&#x3D;null, path&#x3D;&#x2F;dubbo&#x2F;batchSaveAndNameAndId, rpcType&#x3D;dubbo, serviceName&#x3D;org.dromara.soul.examples.dubbo.api.service.DubboMultiParamService, methodName&#x3D;batchSaveAndNameAndId, parameterTypes&#x3D;java.util.List,java.lang.String,java.lang.String, rpcExt&#x3D;&#123;&quot;group&quot;:&quot;&quot;,&quot;version&quot;:&quot;&quot;,&quot;loadbalance&quot;:&quot;random&quot;,&quot;retries&quot;:2,&quot;timeout&quot;:10000,&quot;url&quot;:&quot;&quot;&#125;, enabled&#x3D;true)</span><br><span class="line">2021-01-17 00:51:51.186  INFO 63416 --- [ctReadThread-47] o.d.s.p.a.d.c.ApplicationConfigCache     : init aliaba dubbo reference success there meteData is :MetaData(id&#x3D;1350397139476557824, appName&#x3D;dubbo, contextPath&#x3D;null, path&#x3D;&#x2F;dubbo&#x2F;saveComplexBeanTest, rpcType&#x3D;dubbo, serviceName&#x3D;org.dromara.soul.examples.dubbo.api.service.DubboMultiParamService, methodName&#x3D;saveComplexBeanTest, parameterTypes&#x3D;org.dromara.soul.examples.dubbo.api.entity.ComplexBeanTest, rpcExt&#x3D;&#123;&quot;group&quot;:&quot;&quot;,&quot;version&quot;:&quot;&quot;,&quot;loadbalance&quot;:&quot;random&quot;,&quot;retries&quot;:2,&quot;timeout&quot;:10000,&quot;url&quot;:&quot;&quot;&#125;, enabled&#x3D;true)</span><br><span class="line">2021-01-17 00:51:51.201  INFO 63416 --- [ctReadThread-47] o.d.s.p.a.d.c.ApplicationConfigCache     : init aliaba dubbo reference success there meteData is :MetaData(id&#x3D;1350397139547860992, appName&#x3D;dubbo, contextPath&#x3D;null, path&#x3D;&#x2F;dubbo&#x2F;saveComplexBeanTestAndName, rpcType&#x3D;dubbo, serviceName&#x3D;org.dromara.soul.examples.dubbo.api.service.DubboMultiParamService, methodName&#x3D;saveComplexBeanTestAndName, parameterTypes&#x3D;org.dromara.soul.examples.dubbo.api.entity.ComplexBeanTest,java.lang.String, rpcExt&#x3D;&#123;&quot;group&quot;:&quot;&quot;,&quot;version&quot;:&quot;&quot;,&quot;loadbalance&quot;:&quot;random&quot;,&quot;retries&quot;:2,&quot;timeout&quot;:10000,&quot;url&quot;:&quot;&quot;&#125;, enabled&#x3D;true)</span><br></pre></td></tr></table></figure>
ä½¿ç”¨curl è°ƒç”¨ soul-bootstrap ä»£ç†çš„æ¥å£ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl localhost:9195&#x2F;dubbo&#x2F;findAll </span><br><span class="line">&#x2F;&#x2F;è¿”å›äº†</span><br><span class="line">&#123;&quot;code&quot;:200,&quot;message&quot;:&quot;Access to success!&quot;,&quot;data&quot;:&#123;&quot;name&quot;:&quot;hello world Soul Alibaba Dubbo , findAll&quot;,&quot;id&quot;:&quot;654524173&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>
è¡¨æ˜æˆ‘ä»¬é€šè¿‡soulæˆåŠŸè°ƒç”¨äº†dubboçš„æ¥å£ã€‚</li>
</ol>
<p>æ·±å…¥æºç ï¼Œåœ¨è°ƒç”¨ â€œ/dubbo/findAllâ€ è¿™ä¸ªè·¯å¾„æ—¶ï¼Œdubbo plugin æ‰§è¡Œäº† doExecute æ–¹æ³•ï¼Œç„¶åä» ServerWebExchange ä¸­åˆ†åˆ«è·å–åˆ°äº†<br>soulContext å’Œ metaDataï¼š<br><img src="https://img-blog.csdnimg.cn/202101170117309.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210117011809380.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åœ¨è¿™ä¸¤ä¸ªå¯¹è±¡ä¸­æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å³å°†è°ƒç”¨åˆ°çš„DubboTestServiceå’Œ å¯¹åº”çš„æ–¹æ³•å findAllã€‚<br>åœ¨è¿™é‡Œæˆ‘ä»¬è·å–åˆ°äº† genericServiceï¼Œå¹¶å°†å°è£…å¥½çš„æ–¹æ³•åï¼Œå‚æ•°é€šè¿‡ genericService çš„ $invokeæ–¹æ³•è°ƒç”¨çœŸå®çš„dubboæœåŠ¡endpointï¼Œå†å°†response è¿”å›ç»™soul-bootstrapè¿™è¾¹ã€‚<br><img src="https://img-blog.csdnimg.cn/20210117012348487.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ€»ç»“ï¼šDubboæ’ä»¶éå¸¸å¼ºå¤§ï¼Œèƒ½å¤Ÿé€šè¿‡æ‰«æzookeeperçš„æ–¹å¼å°†æ‰€æœ‰å·²æ³¨å†Œçš„endpoint å¹¶ç›´æ¥æ·»åŠ åˆ°è§„åˆ™ä¸­ï¼Œè¿™ä¸€ç‚¹å¯¹äºdubboç”¨æˆ·æ¥è¯´æ¥å…¥å‡ ä¹æ˜¯é›¶æˆæœ¬çš„ã€‚</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Soul</tag>
      </tags>
  </entry>
  <entry>
    <title>Soul ç½‘å…³æºç åˆ†æï¼ˆå››ï¼‰sign æ’ä»¶</title>
    <url>/2021/01/19/Soul-%E7%BD%91%E5%85%B3%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E5%9B%9B%EF%BC%89sign-%E6%8F%92%E4%BB%B6/</url>
    <content><![CDATA[<p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°è¯•dubboæ’ä»¶å°†httpåè®®è½¬æ¢æˆdubboåè®®ï¼Œä»Šå¤©æˆ‘ä»¬æ¥çœ‹çœ‹ sign æ’ä»¶æ˜¯å¦‚ä½•å®ç°è¯·æ±‚é‰´æƒçš„ã€‚</p>
<a id="more"></a>
<h1 id="æµç¨‹æ¼”ç¤º"><a href="#æµç¨‹æ¼”ç¤º" class="headerlink" title="æµç¨‹æ¼”ç¤º"></a>æµç¨‹æ¼”ç¤º</h1><p>æˆ‘ä»¬å…ˆè¯•è¯•æ²¡æœ‰æ·»åŠ signæ’ä»¶æ—¶ï¼Œæ˜¯å¦èƒ½æ­£å¸¸è¯·æ±‚æ¥å£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  ~ curl localhost:9195&#x2F;dubbo&#x2F;findAll</span><br><span class="line">&#123;&quot;code&quot;:200,&quot;message&quot;:&quot;Access to success!&quot;,&quot;data&quot;:&#123;&quot;name&quot;:&quot;hello world Soul Alibaba Dubbo , findAll&quot;,&quot;id&quot;:&quot;-803129909&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>æˆåŠŸã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨æ’ä»¶ç®¡ç†ä¸­æ‰“å¼€signæ’ä»¶çš„å¼€å…³ã€‚ç„¶åæˆ‘ä»¬åœ¨è®¤è¯ç®¡ç†ä¸­ï¼Œæ–°å¢ä¸€æ¡ AK/SK è®°å½•ï¼š<br><img src="https://img-blog.csdnimg.cn/20210119004613292.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ·»åŠ å®Œæ¯•åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°AppKey å’ŒåŠ å¯†å¯†é’¥å·²ç»ä¸ºæˆ‘ä»¬ç”Ÿæˆå¥½äº†ï¼š<br><img src="https://img-blog.csdnimg.cn/20210119004712413.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç°åœ¨æˆ‘ä»¬å†è¯•è¯•åˆšåˆšä»£ç†dubbo æœåŠ¡ä¸­çš„ /dubbo/findAll æ¥å£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  ~ curl localhost:9195&#x2F;dubbo&#x2F;findAll</span><br><span class="line">&#123;&quot;code&quot;:200,&quot;message&quot;:&quot;Access to success!&quot;,&quot;data&quot;:&#123;&quot;name&quot;:&quot;hello world Soul Alibaba Dubbo , findAll&quot;,&quot;id&quot;:&quot;-541002115&quot;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>å‘ç°æ²¡æœ‰ç”Ÿæ•ˆï¼ŒåŸå› æ˜¯æ²¡æœ‰é…ç½®signçš„é€‰æ‹©å™¨ï¼š<br><img src="https://img-blog.csdnimg.cn/20210119010246549.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/2021011901033031.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/20210119010334975.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æŒ‰ç…§ä¸Šå›¾æ‰€ç¤ºé…ç½®å¥½signé€‰æ‹©å™¨åå†è¯·æ±‚æˆ‘ä»¬é…ç½®äº†é‰´æƒæ ¡éªŒçš„æ¥å£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  ~ curl localhost:9195&#x2F;dubbo&#x2F;findAll</span><br><span class="line">&#123;&quot;code&quot;:401,&quot;message&quot;:&quot;sign parameters are incomplete!&quot;,&quot;data&quot;:null&#125;</span><br></pre></td></tr></table></figure>
<p>æˆäº†ï¼Œæç¤ºæˆ‘ä»¬ç­¾åå‚æ•°ä¸å®Œæ•´ï¼Œä¸‹è¡¨å±•ç¤ºäº†æˆ‘ä»¬éœ€è¦åœ¨headersä¸­æ·»åŠ çš„headerï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>å€¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>timestamp</td>
<td>1571711067186</td>
<td>ä¸Šè¿°ä½ è¿›è¡Œç­¾åçš„æ—¶å€™ä½¿ç”¨çš„æ—¶é—´å€¼</td>
</tr>
<tr>
<td>appKey</td>
<td>1TEST123456781</td>
<td>AKå€¼</td>
</tr>
<tr>
<td>sign</td>
<td>A90E66763793BDBC817CF3B52AAAC041</td>
<td>ä¸Šè¿°å¾—åˆ°çš„ç­¾åå€¼</td>
</tr>
<tr>
<td>version</td>
<td>1.0.0</td>
<td>å›ºå®šé»˜è®¤å€¼</td>
</tr>
<tr>
<td>ç­¾åæ’ä»¶ä¼šé»˜è®¤è¿‡æ»¤5åˆ†é’Ÿä¹‹åçš„è¯·æ±‚ã€‚</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>ç°åœ¨ç›´å¥”å•å…ƒæµ‹è¯•ç±»ï¼ŒæŠŠç°æœ‰çš„æ—¶é—´æˆ³ï¼Œappkey å’Œ sign æ”¹å†™æˆè‡ªå·±çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> SignService signService;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> ServerWebExchange exchange;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//è¿™é‡Œæ”¹æˆè‡ªå·±çš„</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> String appKey = <span class="string">"E841FEDBF8EE4912878993EC84F70947"</span>;</span><br><span class="line">   <span class="comment">//è¿™é‡Œæ”¹æˆè‡ªå·±çš„</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> String secretKey = <span class="string">"4FBB99E1B97B45D79D8F891D45DBB97E"</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> SoulContext passed;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Value</span>(<span class="string">"$&#123;soul.sign.delay:5&#125;"</span>)</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> delay;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.signService = <span class="keyword">new</span> DefaultSignService();</span><br><span class="line">       <span class="keyword">this</span>.exchange = MockServerWebExchange.from(MockServerHttpRequest.get(<span class="string">"localhost"</span>).build());</span><br><span class="line">       <span class="comment">//è¿™é‡Œæ”¹æˆè‡ªå·±çš„ï¼Œè·¯å¾„æ˜¯é»˜è®¤ç­¾åçš„ä¸€éƒ¨åˆ†</span></span><br><span class="line">       <span class="keyword">final</span> String path = <span class="string">"/dubbo/findAll"</span>;</span><br><span class="line">       PluginData signData = <span class="keyword">new</span> PluginData();</span><br><span class="line">       signData.setId(<span class="string">"1"</span>);</span><br><span class="line">       signData.setName(PluginEnum.SIGN.getName());</span><br><span class="line">       signData.setEnabled(<span class="keyword">true</span>);</span><br><span class="line">       signData.setRole(<span class="number">1</span>);</span><br><span class="line">       BaseDataCache.getInstance().cachePluginData(signData);</span><br><span class="line">       </span><br><span class="line">       AppAuthData authData = <span class="keyword">new</span> AppAuthData();</span><br><span class="line">       authData.setAppKey(appKey);</span><br><span class="line">       authData.setAppSecret(secretKey);</span><br><span class="line">       authData.setEnabled(<span class="keyword">true</span>);</span><br><span class="line">       AuthPathData authPathData = <span class="keyword">new</span> AuthPathData();</span><br><span class="line">       authPathData.setAppName(<span class="string">"test-api"</span>);</span><br><span class="line">       authPathData.setPath(path);</span><br><span class="line">       authPathData.setEnabled(<span class="keyword">true</span>);</span><br><span class="line">       authData.setPathDataList(Lists.newArrayList(authPathData));</span><br><span class="line">       SignAuthDataCache.getInstance().cacheAuthData(authData);</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">this</span>.passed = <span class="keyword">new</span> SoulContext();</span><br><span class="line">       <span class="keyword">this</span>.passed.setModule(<span class="string">"/dubbo"</span>);</span><br><span class="line">       <span class="keyword">this</span>.passed.setMethod(<span class="string">"/findAll"</span>);</span><br><span class="line">       <span class="keyword">this</span>.passed.setRpcType(<span class="string">"dubbo"</span>);</span><br><span class="line">       <span class="keyword">this</span>.passed.setHttpMethod(<span class="string">"GET"</span>);</span><br><span class="line">       <span class="keyword">this</span>.passed.setPath(path);</span><br><span class="line">       <span class="keyword">final</span> String timestamp = String.valueOf(System.currentTimeMillis());</span><br><span class="line">       <span class="keyword">this</span>.passed.setTimestamp(timestamp);</span><br><span class="line">       <span class="keyword">this</span>.passed.setSign(buildSign(secretKey, timestamp, <span class="keyword">this</span>.passed.getPath()));</span><br><span class="line">       <span class="comment">//åœ¨è¿™é‡Œæ‰“æ–­ç‚¹ï¼Œè·å–åˆ° this.getpassed ä¸­çš„sign</span></span><br><span class="line">       <span class="keyword">this</span>.passed.setAppKey(appKey);</span><br><span class="line">       <span class="keyword">this</span>.passed.setContextPath(<span class="string">"/"</span>);</span><br><span class="line">       <span class="keyword">this</span>.passed.setRealUrl(<span class="string">"/dubbo/findAll"</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æˆ‘ä»¬åœ¨postman è¯·æ±‚çš„ headers ä¸­æ·»åŠ ç­¾åç›¸å…³çš„headerå¹¶è¯·æ±‚ï¼š<br><img src="https://img-blog.csdnimg.cn/20210119012826823.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆåŠŸé€šè¿‡äº†æ ¡éªŒã€‚</p>
<h1 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The type Default sign service.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xiaoyu</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultSignService</span> <span class="keyword">implements</span> <span class="title">SignService</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å¯ä»¥è‡ªå®šä¹‰signè¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºåˆ†é’Ÿ</span></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;soul.sign.delay:5&#125;"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> delay;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pair&lt;Boolean, String&gt; <span class="title">signVerify</span><span class="params">(<span class="keyword">final</span> ServerWebExchange exchange)</span> </span>&#123;</span><br><span class="line">        PluginData signData = BaseDataCache.getInstance().obtainPluginData(PluginEnum.SIGN.getName());</span><br><span class="line">        <span class="comment">//éœ€è¦é…ç½® sign æ’ä»¶ä¸” sign æ’ä»¶æ˜¯æ¿€æ´»çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">if</span> (signData != <span class="keyword">null</span> &amp;&amp; signData.getEnabled()) &#123;</span><br><span class="line">            <span class="keyword">final</span> SoulContext soulContext = exchange.getAttribute(Constants.CONTEXT);</span><br><span class="line">            <span class="keyword">assert</span> soulContext != <span class="keyword">null</span>;</span><br><span class="line">            <span class="comment">//æ‰§è¡Œverifyæ–¹æ³•æ ¡éªŒç­¾å</span></span><br><span class="line">            <span class="keyword">return</span> verify(soulContext, exchange);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Pair.of(Boolean.TRUE, <span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> Pair&lt;Boolean, String&gt; <span class="title">verify</span><span class="params">(<span class="keyword">final</span> SoulContext soulContext, <span class="keyword">final</span> ServerWebExchange exchange)</span> </span>&#123;</span><br><span class="line">    	<span class="comment">//ä»»æ„ä¸ºç©ºï¼Œåˆ™å¤±è´¥</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(soulContext.getAppKey())</span><br><span class="line">                || StringUtils.isBlank(soulContext.getSign())</span><br><span class="line">                || StringUtils.isBlank(soulContext.getTimestamp())) &#123;</span><br><span class="line">            log.error(<span class="string">"sign parameters are incomplete,&#123;&#125;"</span>, soulContext);</span><br><span class="line">            <span class="keyword">return</span> Pair.of(Boolean.FALSE, Constants.SIGN_PARAMS_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è·å–å½“å‰çš„æ—¶é—´æˆ³</span></span><br><span class="line">        <span class="keyword">final</span> LocalDateTime start = DateUtils.formatLocalDateTimeFromTimestampBySystemTimezone(Long.parseLong(soulContext.getTimestamp()));</span><br><span class="line">        <span class="keyword">final</span> LocalDateTime now = LocalDateTime.now();</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> between = DateUtils.acquireMinutesBetween(start, now);</span><br><span class="line">        <span class="comment">//è·Ÿdelayåšæ¯”å¯¹</span></span><br><span class="line">        <span class="keyword">if</span> (between &gt; delay) &#123;</span><br><span class="line">            <span class="keyword">return</span> Pair.of(Boolean.FALSE, String.format(SoulResultEnum.SING_TIME_IS_TIMEOUT.getMsg(), delay));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sign(soulContext, exchange);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * verify sign .</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> soulContext &#123;<span class="doctag">@linkplain</span> SoulContext&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> result : True is pass, False is not pass.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Pair&lt;Boolean, String&gt; <span class="title">sign</span><span class="params">(<span class="keyword">final</span> SoulContext soulContext, <span class="keyword">final</span> ServerWebExchange exchange)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> AppAuthData appAuthData = SignAuthDataCache.getInstance().obtainAuthData(soulContext.getAppKey());</span><br><span class="line">        <span class="comment">//ä¸€ç³»åˆ—åˆ¤ç©ºé€»è¾‘</span></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(appAuthData) || !appAuthData.getEnabled()) &#123;</span><br><span class="line">            log.error(<span class="string">"sign APP_kEY does not exist or has been disabled,&#123;&#125;"</span>, soulContext.getAppKey());</span><br><span class="line">            <span class="keyword">return</span> Pair.of(Boolean.FALSE, Constants.SIGN_APP_KEY_IS_NOT_EXIST);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;AuthPathData&gt; pathDataList = appAuthData.getPathDataList();</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(pathDataList)) &#123;</span><br><span class="line">            log.error(<span class="string">"You have not configured the sign path:&#123;&#125;"</span>, soulContext.getAppKey());</span><br><span class="line">            <span class="keyword">return</span> Pair.of(Boolean.FALSE, Constants.SIGN_PATH_NOT_EXIST);</span><br><span class="line">        &#125;</span><br><span class="line">   		<span class="comment">//æŸ¥çœ‹pathæ˜¯å¦åœ¨é…ç½®åˆ—è¡¨ä¸­</span></span><br><span class="line">        <span class="keyword">boolean</span> match = pathDataList.stream().filter(AuthPathData::getEnabled)</span><br><span class="line">                .anyMatch(e -&gt; PathMatchUtils.match(e.getPath(), soulContext.getPath()));</span><br><span class="line">        <span class="keyword">if</span> (!match) &#123;</span><br><span class="line">            log.error(<span class="string">"You have not configured the sign path:&#123;&#125;,&#123;&#125;"</span>, soulContext.getAppKey(), soulContext.getRealUrl());</span><br><span class="line">            <span class="keyword">return</span> Pair.of(Boolean.FALSE, Constants.SIGN_PATH_NOT_EXIST);</span><br><span class="line">        &#125;</span><br><span class="line">        String sigKey = SignUtils.generateSign(appAuthData.getAppSecret(), buildParamsMap(soulContext));</span><br><span class="line">        <span class="keyword">boolean</span> result = Objects.equals(sigKey, soulContext.getSign());</span><br><span class="line">        <span class="comment">//æ ¡éªŒsignæ˜¯å¦åˆæ³•</span></span><br><span class="line">        <span class="keyword">if</span> (!result) &#123;</span><br><span class="line">            log.error(<span class="string">"the SignUtils generated signature value is:&#123;&#125;,the accepted value is:&#123;&#125;"</span>, sigKey, soulContext.getSign());</span><br><span class="line">            <span class="keyword">return</span> Pair.of(Boolean.FALSE, Constants.SIGN_VALUE_IS_ERROR);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            List&lt;AuthParamData&gt; paramDataList = appAuthData.getParamDataList();</span><br><span class="line">            <span class="keyword">if</span> (CollectionUtils.isEmpty(paramDataList)) &#123;</span><br><span class="line">                <span class="keyword">return</span> Pair.of(Boolean.TRUE, <span class="string">""</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            paramDataList.stream().filter(p -&gt;</span><br><span class="line">                    (<span class="string">"/"</span> + p.getAppName()).equals(soulContext.getContextPath()))</span><br><span class="line">                    .map(AuthParamData::getAppParam)</span><br><span class="line">                    .filter(StringUtils::isNoneBlank).findFirst()</span><br><span class="line">                    .ifPresent(param -&gt; exchange.getRequest().mutate().headers(httpHeaders -&gt; httpHeaders.set(Constants.APP_PARAM, param)).build()</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Pair.of(Boolean.TRUE, <span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map&lt;String, String&gt; <span class="title">buildParamsMap</span><span class="params">(<span class="keyword">final</span> SoulContext dto)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = Maps.newHashMapWithExpectedSize(<span class="number">3</span>);</span><br><span class="line">        map.put(Constants.TIMESTAMP, dto.getTimestamp());</span><br><span class="line">        map.put(Constants.PATH, dto.getPath());</span><br><span class="line">        map.put(Constants.VERSION, <span class="string">"1.0.0"</span>);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å…¶å®ç­¾åæ’ä»¶çš„æ ¸å¿ƒé€»è¾‘æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å®ç°äº† sign ã€ verifyç­‰æ–¹æ³•ï¼Œå†å®ç° SignService æ¥å£çš„ signVerifyå‡½æ•°å®Œæˆæ•´ä¸ªç­¾åçš„æµç¨‹ã€‚å¦‚æœæœ‰éœ€è¦æˆ‘ä»¬å¯ä»¥åŠ å…¥è‡ªå·±çš„ç­¾åæ ¡éªŒé€»è¾‘ï¼Œæ¯”å¦‚ç”¨JWTä¹‹ç±»çš„æ¥å®ç°ï¼Œåªéœ€è¦å®ç° SignService æ¥å£çš„ signVerify å³å¯ã€‚</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Soul</tag>
      </tags>
  </entry>
  <entry>
    <title>Soul ç½‘å…³æºç åˆ†æï¼ˆäº”ï¼‰Spring Cloud æ’ä»¶ï¼ˆä¸€ï¼‰</title>
    <url>/2021/01/19/Soul-%E7%BD%91%E5%85%B3%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E4%BA%94%EF%BC%89Spring-Cloud-%E6%8F%92%E4%BB%B6%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    <content><![CDATA[<p>ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å­¦ä¹ äº† sign æ’ä»¶æ˜¯å¦‚ä½•å®ç°è¯·æ±‚é‰´æƒçš„ï¼Œä»Šå¤©æˆ‘ä»¬æ¥è¯•è¯• Soul çš„Spring Cloud æ’ä»¶ã€‚</p>
<a id="more"></a>
<h2 id="æµç¨‹æ¼”ç¤º"><a href="#æµç¨‹æ¼”ç¤º" class="headerlink" title="æµç¨‹æ¼”ç¤º"></a>æµç¨‹æ¼”ç¤º</h2><p>å…ˆè§£é™¤soul-bootstrap Spring Cloud ä¾èµ–éƒ¨åˆ†çš„å¦‚ä¸‹æ³¨é‡Šï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">        <span class="comment">&lt;!--soul springCloud plugin start--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.dromara<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>soul-spring-boot-starter-plugin-springcloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-ribbon<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--soul springCloud plugin start end--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- springCloud if you config register center is nacos please dependency this--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;version&gt;2.1.0.RELEASE&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- springCloud if you config register center is eureka please dependency end--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Spring Cloud æ’ä»¶æ”¯æŒ Nacos æˆ–è€… Eurekaä½œä¸ºæœåŠ¡æ³¨å†Œä¸­çš„ï¼Œè¿™ä¸€æ¬¡æˆ‘ä»¬é€‰æ‹©Eurekaã€‚</p>
<p>åœ¨ soul-bootstrap çš„ application.yml ä¸­æ·»åŠ Eureka ç›¸å…³ä¾èµ–ï¼š</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">serviceUrl:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8761/eureka/</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">prefer-ip-address:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ soul-admin ä¸­å¼€å¯Spring Cloud æ’ä»¶æ”¯æŒã€‚<br><img src="https://img-blog.csdnimg.cn/20210119224248721.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ç›´æ¥å¯åŠ¨ soul-examples-springcloud å’Œ soul-examples-eurekaï¼Œæ‰“å¼€Eurekaçš„é¡µé¢å¯ä»¥çœ‹åˆ°å·²ç»æŠŠæˆ‘ä»¬çš„åº”ç”¨æ³¨å†Œå¥½äº†ã€‚<br><img src="https://img-blog.csdnimg.cn/2021011922585019.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å†å›åˆ° soul-adminï¼Œå‘ç°æˆ‘ä»¬çš„ Spring Cloud æœåŠ¡çš„ç›¸å…³ endpoints å·²ç»åŠ åˆ°äº†é€‰æ‹©å™¨å’Œè§„åˆ™åˆ—è¡¨ä¸­ï¼š<br><img src="https://img-blog.csdnimg.cn/20210119230144991.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨ curl æ¥æµ‹è¯•ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  ~ curl &quot;localhost:9195&#x2F;springcloud&#x2F;order&#x2F;findById?id&#x3D;1&quot;</span><br><span class="line">&#123;&quot;id&quot;:&quot;1&quot;,&quot;name&quot;:&quot;hello world spring cloud findById&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>æˆåŠŸè¿”å›æ•°æ®ã€‚ç°åœ¨æˆ‘ä»¬ä½¿ç”¨wrkæ‰§è¡Œä¸€ä¸‹å‹æµ‹ï¼Œä»¥ä¸‹æ˜¯ä¸é€‚ç”¨soulç½‘å…³</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  ~ wrk -t8 -c200 -d30s --latency  &quot;http:&#x2F;&#x2F;localhost:8884&#x2F;order&#x2F;findById?id&#x3D;1&quot;</span><br><span class="line">Running 30s test @ http:&#x2F;&#x2F;localhost:8884&#x2F;order&#x2F;findById?id&#x3D;1</span><br><span class="line">  8 threads and 200 connections</span><br><span class="line">  Thread Stats   Avg      Stdev     Max   +&#x2F;- Stdev</span><br><span class="line">    Latency     8.21ms    6.05ms 155.20ms   92.54%</span><br><span class="line">    Req&#x2F;Sec     2.95k   703.14    15.51k    79.58%</span><br><span class="line">  Latency Distribution</span><br><span class="line">     50%    7.27ms</span><br><span class="line">     75%    9.19ms</span><br><span class="line">     90%   11.65ms</span><br><span class="line">     99%   33.06ms</span><br><span class="line">  700305 requests in 30.07s, 119.00MB read</span><br><span class="line">Requests&#x2F;sec:  23285.91</span><br><span class="line">Transfer&#x2F;sec:      3.96MB</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨soulç½‘å…³</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  ~ wrk -t8 -c200 -d30s --latency  &quot;http:&#x2F;&#x2F;localhost:9195&#x2F;springcloud&#x2F;order&#x2F;findById?id&#x3D;1&quot;</span><br><span class="line">Running 30s test @ http:&#x2F;&#x2F;localhost:9195&#x2F;springcloud&#x2F;order&#x2F;findById?id&#x3D;1</span><br><span class="line">  8 threads and 200 connections</span><br><span class="line">  Thread Stats   Avg      Stdev     Max   +&#x2F;- Stdev</span><br><span class="line">    Latency    47.59ms   37.60ms 294.45ms   80.29%</span><br><span class="line">    Req&#x2F;Sec   592.92    129.17     0.97k    70.40%</span><br><span class="line">  Latency Distribution</span><br><span class="line">     50%   36.84ms</span><br><span class="line">     75%   61.51ms</span><br><span class="line">     90%   99.43ms</span><br><span class="line">     99%  176.76ms</span><br><span class="line">  141697 requests in 30.10s, 28.13MB read</span><br><span class="line">Requests&#x2F;sec:   4707.18</span><br><span class="line">Transfer&#x2F;sec:      0.93MB</span><br></pre></td></tr></table></figure>
<p>å¯èƒ½è·Ÿç¬”è€…æœºå™¨æœ‰å…³ï¼Œç½‘å…³åœ¨8ä¸ªçº¿ç¨‹200ä¸ªè¿æ¥æµ‹è¯•30ç§’çš„æƒ…å†µï¼Œå»¶è¿Ÿæœ‰æ¯”è¾ƒæ˜æ˜¾çš„æå‡ï¼Œåˆæ­¥æ€€ç–‘å—åˆ°äº†æ—¥å¿—è¾“å‡ºçš„å½±å“ï¼Œè°ƒæ•´æ—¥å¿—è¾“å‡ºçº§åˆ«åå†è¿›è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  ~ wrk -t8 -c200 -d30s --latency  &quot;http:&#x2F;&#x2F;localhost:9195&#x2F;springcloud&#x2F;order&#x2F;findById?id&#x3D;1&quot;</span><br><span class="line">Running 30s test @ http:&#x2F;&#x2F;localhost:9195&#x2F;springcloud&#x2F;order&#x2F;findById?id&#x3D;1</span><br><span class="line">  8 threads and 200 connections</span><br><span class="line">^C  Thread Stats   Avg      Stdev     Max   +&#x2F;- Stdev</span><br><span class="line">    Latency    39.94ms   26.08ms 218.19ms   71.90%</span><br><span class="line">    Req&#x2F;Sec   657.54    122.81     0.91k    78.91%</span><br><span class="line">  Latency Distribution</span><br><span class="line">     50%   35.04ms</span><br><span class="line">     75%   53.40ms</span><br><span class="line">     90%   74.22ms</span><br><span class="line">     99%  122.25ms</span><br><span class="line">  33581 requests in 6.44s, 6.67MB read</span><br><span class="line">Requests&#x2F;sec:   5214.23</span><br><span class="line">Transfer&#x2F;sec:      1.04MB</span><br></pre></td></tr></table></figure>
<p>è®¾ç½®æ—¥å¿—è¾“å‡ºçº§åˆ«ä¸ºerroråæ€§èƒ½æŸè€—è¦å°ä¸€äº›ã€‚</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Soul</tag>
      </tags>
  </entry>
  <entry>
    <title>Soul ç½‘å…³æºç åˆ†æï¼ˆå…­ï¼‰ä½¿ç”¨websocketåŒæ­¥æ•°æ®åˆ°ç½‘å…³</title>
    <url>/2021/01/21/Soul-%E7%BD%91%E5%85%B3%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%88%E5%85%AD%EF%BC%89%E4%BD%BF%E7%94%A8websocket%E5%90%8C%E6%AD%A5%E6%95%B0%E6%8D%AE%E5%88%B0%E7%BD%91%E5%85%B3/</url>
    <content><![CDATA[<p>Soul æä¾›äº†å¤šç§æ•°æ®åŒæ­¥çš„ç­–ç•¥ï¼Œé»˜è®¤ä¸”æ¨èçš„æ–¹å¼æ˜¯ä½¿ç”¨ websocketã€‚ä¸ºäº†è¿½æ±‚æè‡´çš„å“åº”é€Ÿåº¦ï¼Œæ‰€æœ‰çš„é…ç½®æ²¡æœ‰é€‰æ‹©å­˜åˆ°redisï¼ŒMySQLæˆ–æ˜¯å…¶ä»–å­˜å‚¨æ–¹å¼ä¸­ï¼Œè€Œæ˜¯ç›´æ¥åœ¨HashMapä¸­ç¼“å­˜ï¼Œå¯ä»¥è¾¾åˆ°æä½çš„å»¶è¿Ÿã€‚</p>
<a id="more"></a>
<p>ä¸‹å›¾æ˜¯ä¸‰ç§ç­–ç•¥ä¸‹ï¼ŒSoul ç½‘å…³ä¸ soul-admin æ•°æ®åŒæ­¥çš„æµç¨‹ï¼š<br><img src="https://img-blog.csdnimg.cn/20210121001006462.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dpY2tlZFdpbmdz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>å€ŸåŠ©websocketçš„ç‰¹æ€§ï¼ŒDataChangedEventDispatcher å¾—ä»¥ä¸»åŠ¨å‘ Soul ç½‘å…³æ¨é€æ•°æ®å˜æ›´ã€‚å½“ soul-admin ä¸ soul-bootstrap é¦–æ¬¡å»ºç«‹è¿æ¥æ—¶ï¼Œä¼šå‘soul-bootstrap æ¨é€ä¸€æ¬¡å…¨é‡çš„é…ç½®æ•°æ®ï¼Œå¢é‡çš„æ•°æ®ä¹Ÿå¯ä»¥ç”± soul-admin ä¸»åŠ¨æ¨é€ç»™ soul-bootstrapã€‚</p>
<p>soul-admin ä¼šæ ¹æ®é…ç½®åŠ è½½ä»¥ä¸‹çš„ beanï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The WebsocketListener(default strategy).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(name = <span class="string">"soul.sync.websocket.enabled"</span>, havingValue = <span class="string">"true"</span>, matchIfMissing = <span class="keyword">true</span>)</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(WebsocketSyncProperties<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">static</span> <span class="title">class</span> <span class="title">WebsocketListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›‘å¬æ•°æ®å˜åŒ–çš„listener.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the data changed listener</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span>(WebsocketDataChangedListener<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">DataChangedListener</span> <span class="title">websocketDataChangedListener</span>() </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebsocketDataChangedListener();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * websocketæœåŠ¡ç«¯ï¼Œè´Ÿè´£websocket æ•°æ®çš„ OnOpenï¼ŒOnMessageï¼ŒOnCloseï¼ŒOnErrorç­‰ç”Ÿå‘½å‘¨æœŸçš„å¤„ç†å’Œæ•°æ®æ¨é€ã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the websocket collector</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span>(WebsocketCollector<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">WebsocketCollector</span> <span class="title">websocketCollector</span>() </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebsocketCollector();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Server endpoint exporter server endpoint exporter.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the server endpoint exporter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span>(ServerEndpointExporter<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">ServerEndpointExporter</span> <span class="title">serverEndpointExporter</span>() </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServerEndpointExporter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼ŒWebsocketDataChangedListener å°è£…äº†å¯¹ä¸€ç³»åˆ—æ•°æ®çš„ç›‘å¬ï¼Œä»¥æ’ä»¶å˜æ›´ç›‘å¬ä¸ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPluginChanged</span><span class="params">(<span class="keyword">final</span> List&lt;PluginData&gt; pluginDataList, <span class="keyword">final</span> DataEventTypeEnum eventType)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// å…ˆå°è£… websocket æ•°æ®ï¼Œå†ä½¿ç”¨ WebsocketCollector æ¥å‘é€jsonåºåˆ—åŒ–åçš„æ•°æ®åˆ° soul-bootstrap.</span></span><br><span class="line">    WebsocketData&lt;PluginData&gt; websocketData =</span><br><span class="line">            <span class="keyword">new</span> WebsocketData&lt;&gt;(ConfigGroupEnum.PLUGIN.name(), eventType.name(), pluginDataList);</span><br><span class="line">    WebsocketCollector.send(GsonUtils.getInstance().toJson(websocketData), eventType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The type Websocket data changed listener.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xiaoyu(Myth)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> huangxiaofeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@ServerEndpoint</span>(<span class="string">"/websocket"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebsocketCollector</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;Session&gt; SESSION_SET = <span class="keyword">new</span> CopyOnWriteArraySet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SESSION_KEY = <span class="string">"sessionKey"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** ç•¥ **/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * On message.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message the message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session the session</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(<span class="keyword">final</span> String message, <span class="keyword">final</span> Session session)</span> </span>&#123;</span><br><span class="line">    	<span class="comment">// åªæœ‰ message çš„ç±»å‹æ˜¯ MYSELFæ—¶æ‰å¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span> (message.equals(DataEventTypeEnum.MYSELF.name())) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">            	<span class="comment">//å°† websocket session ä¿å­˜åˆ° ThreadLocal ä¸­ã€‚</span></span><br><span class="line">                ThreadLocalUtil.put(SESSION_KEY, session);</span><br><span class="line">                </span><br><span class="line">                SpringBeanUtils.getInstance().getBean(SyncDataService<span class="class">.<span class="keyword">class</span>).<span class="title">syncAll</span>(<span class="title">DataEventTypeEnum</span>.<span class="title">MYSELF</span>)</span>;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                ThreadLocalUtil.clear();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Send.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message the message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type    the type</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(<span class="keyword">final</span> String message, <span class="keyword">final</span> DataEventTypeEnum type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(message)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (DataEventTypeEnum.MYSELF == type) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Session session = (Session) ThreadLocalUtil.get(SESSION_KEY);</span><br><span class="line">                    <span class="keyword">if</span> (session != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        session.getBasicRemote().sendText(message);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    log.error(<span class="string">"websocket send result is exception: "</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å‘æ‰€æœ‰å­˜åœ¨çš„session å‘é€æ¶ˆæ¯</span></span><br><span class="line">            <span class="keyword">for</span> (Session session : SESSION_SET) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    session.getBasicRemote().sendText(message);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    log.error(<span class="string">"websocket send result is exception: "</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“ DataEventTypeEnum æ˜¯ MYSELF æ—¶ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å‘æ¥ MYSELF æ¶ˆæ¯æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šæŠŠæ‰€æœ‰çš„é…ç½®æ•°æ®åŒæ­¥ç»™å®¢æˆ·ç«¯ï¼Œå…·ä½“çš„ä»£ç å®ç°åœ¨ WebsocketSyncDataConfiguration è¿™ä¸ªç±»åŠ è½½ã€åˆ›å»º WebsocketSyncDataService bean æ—¶ï¼Œåœ¨ WebsocketSyncDataService ç±»ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebsocketSyncDataService</span> <span class="keyword">implements</span> <span class="title">SyncDataService</span>, <span class="title">AutoCloseable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;WebSocketClient&gt; clients = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ScheduledThreadPoolExecutor executor;</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">WebsocketSyncDataService</span><span class="params">(<span class="keyword">final</span> WebsocketConfig websocketConfig,</span></span></span><br><span class="line"><span class="function"><span class="params">	                                    <span class="keyword">final</span> PluginDataSubscriber pluginDataSubscriber,</span></span></span><br><span class="line"><span class="function"><span class="params">	                                    <span class="keyword">final</span> List&lt;MetaDataSubscriber&gt; metaDataSubscribers,</span></span></span><br><span class="line"><span class="function"><span class="params">	                                    <span class="keyword">final</span> List&lt;AuthDataSubscriber&gt; authDataSubscribers)</span> </span>&#123;</span><br><span class="line">	        String[] urls = StringUtils.split(websocketConfig.getUrls(), <span class="string">","</span>);</span><br><span class="line">	        executor = <span class="keyword">new</span> ScheduledThreadPoolExecutor(urls.length, SoulThreadFactory.create(<span class="string">"websocket-connect"</span>, <span class="keyword">true</span>));</span><br><span class="line">	        <span class="keyword">for</span> (String url : urls) &#123;</span><br><span class="line">	            <span class="keyword">try</span> &#123;</span><br><span class="line">	            	<span class="comment">//éå†æ‰€æœ‰urlï¼Œå°† SoulWebsocketClient å®ä¾‹åŠ åˆ° clientsä¸­</span></span><br><span class="line">	                clients.add(<span class="keyword">new</span> SoulWebsocketClient(<span class="keyword">new</span> URI(url), Objects.requireNonNull(pluginDataSubscriber), metaDataSubscribers, authDataSubscribers));</span><br><span class="line">	            &#125; <span class="keyword">catch</span> (URISyntaxException e) &#123;</span><br><span class="line">	                log.error(<span class="string">"websocket url(&#123;&#125;) is error"</span>, url, e);</span><br><span class="line">	            &#125;</span><br><span class="line">	        &#125;</span><br><span class="line">        <span class="comment">/** ç•¥ **/</span></span><br></pre></td></tr></table></figure>
<p>è€Œåœ¨å®ä¾‹åŒ– SoulWebsocketClientæ—¶ï¼Œä¼šè°ƒç”¨å¦‚ä¸‹çš„å‡½æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(<span class="keyword">final</span> ServerHandshake serverHandshake)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (!alreadySync) &#123;</span><br><span class="line">         send(DataEventTypeEnum.MYSELF.name());</span><br><span class="line">         alreadySync = <span class="keyword">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>clientä¼šåœ¨ websocket open çš„æ—¶å€™ å‘é€ MYSELF æ¶ˆæ¯åˆ°æœåŠ¡ç«¯ï¼ŒéªŒè¯äº†ä¸Šé¢æˆ‘ä»¬çš„æƒ³æ³•ã€‚å…¶ä»–ç±»å‹çš„ DataEventTypeEnum å‘é€åˆ™æ˜¯é€šè¿‡ onMessage å¤„ç†ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>soul å·§å¦™å¾—è¿ç”¨äº† websocket è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œå°†æ•°æ®ç›´æ¥æ”¾åˆ°JVMçš„æ–¹æ³•ä¹Ÿä½“ç°äº†å¯¹æ€§èƒ½çš„æè‡´è¿½æ±‚ã€‚</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>Soul</tag>
      </tags>
  </entry>
</search>
